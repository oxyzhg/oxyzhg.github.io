(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{110:function(e,n,t){"use strict";t.d(n,"a",(function(){return p})),t.d(n,"b",(function(){return b}));var o=t(0),r=t.n(o);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var d=r.a.createContext({}),s=function(e){var n=r.a.useContext(d),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},p=function(e){var n=s(e.components);return r.a.createElement(d.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},u=r.a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,a=e.parentName,d=c(e,["components","mdxType","originalType","parentName"]),p=s(t),u=o,b=p["".concat(a,".").concat(u)]||p[u]||m[u]||i;return t?r.a.createElement(b,l(l({ref:n},d),{},{components:t})):r.a.createElement(b,l({ref:n},d))}));function b(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,a=new Array(i);a[0]=u;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l.mdxType="string"==typeof e?e:o,a[1]=l;for(var d=2;d<i;d++)a[d]=t[d];return r.a.createElement.apply(null,a)}return r.a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},63:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return a})),t.d(n,"metadata",(function(){return l})),t.d(n,"toc",(function(){return c})),t.d(n,"default",(function(){return s}));var o=t(3),r=t(7),i=(t(0),t(110)),a={id:"data-driven",title:"\u6570\u636e\u9a71\u52a8"},l={unversionedId:"advanced/vue/data-driven",id:"advanced/vue/data-driven",isDocsHomePage:!1,title:"\u6570\u636e\u9a71\u52a8",description:"new Vue \u53d1\u751f\u4e86\u4ec0\u4e48",source:"@site/docs/advanced/vue/data-driven.md",slug:"/advanced/vue/data-driven",permalink:"/fex/docs/advanced/vue/data-driven",editUrl:"https://github.com/oxyzhg/fex/edit/main/docs/advanced/vue/data-driven.md",version:"current",sidebar:"advanced",previous:{title:"\u6982\u89c8",permalink:"/fex/docs/advanced/vue"},next:{title:"\u7ec4\u4ef6\u5316",permalink:"/fex/docs/advanced/vue/componentization"}},c=[{value:"new Vue \u53d1\u751f\u4e86\u4ec0\u4e48",id:"new-vue-\u53d1\u751f\u4e86\u4ec0\u4e48",children:[]},{value:"Vue \u5b9e\u4f8b\u6302\u8f7d",id:"vue-\u5b9e\u4f8b\u6302\u8f7d",children:[]},{value:"render",id:"render",children:[]},{value:"Virtual DOM",id:"virtual-dom",children:[]},{value:"createElement",id:"createelement",children:[{value:"children \u7684\u89c4\u8303\u5316",id:"children-\u7684\u89c4\u8303\u5316",children:[]},{value:"VNode \u7684\u521b\u5efa",id:"vnode-\u7684\u521b\u5efa",children:[]}]}],d={toc:c};function s(e){var n=e.components,t=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(o.a)({},d,t,{components:n,mdxType:"MDXLayout"}),Object(i.b)("h2",{id:"new-vue-\u53d1\u751f\u4e86\u4ec0\u4e48"},"new Vue \u53d1\u751f\u4e86\u4ec0\u4e48"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-js",metastring:'title="src/core/instance/index.js"',title:'"src/core/instance/index.js"'},"function Vue(options) {\n  if (process.env.NODE_ENV !== 'production' && !(this instanceof Vue)) {\n    warn('Vue is a constructor and should be called with the `new` keyword');\n  }\n  // highlight-next-line\n  this._init(options);\n}\n")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-js",metastring:'title="src/core/instance/init.js"',title:'"src/core/instance/init.js"'},"Vue.prototype._init = function (options?: Object) {\n  const vm: Component = this;\n  // a uid\n  vm._uid = uid++;\n\n  let startTag, endTag;\n  /* istanbul ignore if */\n  if (process.env.NODE_ENV !== 'production' && config.performance && mark) {\n    startTag = `vue-perf-start:${vm._uid}`;\n    endTag = `vue-perf-end:${vm._uid}`;\n    mark(startTag);\n  }\n\n  // a flag to avoid this being observed\n  vm._isVue = true;\n  // merge options\n  if (options && options._isComponent) {\n    // optimize internal component instantiation\n    // since dynamic options merging is pretty slow, and none of the\n    // internal component options needs special treatment.\n    initInternalComponent(vm, options);\n  } else {\n    // highlight-next-line\n    vm.$options = mergeOptions(resolveConstructorOptions(vm.constructor), options || {}, vm);\n  }\n  /* istanbul ignore else */\n  if (process.env.NODE_ENV !== 'production') {\n    initProxy(vm);\n  } else {\n    vm._renderProxy = vm;\n  }\n  // expose real self\n  vm._self = vm;\n  // highlight-start\n  initLifecycle(vm);\n  initEvents(vm);\n  initRender(vm);\n  callHook(vm, 'beforeCreate');\n  initInjections(vm); // resolve injections before data/props\n  initState(vm);\n  initProvide(vm); // resolve provide after data/props\n  callHook(vm, 'created');\n  // highlight-end\n\n  /* istanbul ignore if */\n  if (process.env.NODE_ENV !== 'production' && config.performance && mark) {\n    vm._name = formatComponentName(vm, false);\n    mark(endTag);\n    measure(`vue ${vm._name} init`, startTag, endTag);\n  }\n\n  if (vm.$options.el) {\n    // highlight-next-line\n    vm.$mount(vm.$options.el);\n  }\n};\n")),Object(i.b)("p",null,"Vue \u521d\u59cb\u5316\u4e3b\u8981\u5c31\u5e72\u4e86\u51e0\u4ef6\u4e8b\u60c5\uff1a\u5408\u5e76\u914d\u7f6e\uff0c\u521d\u59cb\u5316\u751f\u547d\u5468\u671f\uff0c\u521d\u59cb\u5316\u4e8b\u4ef6\u4e2d\u5fc3\uff0c\u521d\u59cb\u5316\u6e32\u67d3\uff0c\u521d\u59cb\u5316 data\u3001props\u3001computed\u3001watcher \u7b49\u3002"),Object(i.b)("p",null,"\u6ce8\u610f\u8fd9\u91cc\uff0c\u6267\u884c ",Object(i.b)("inlineCode",{parentName:"p"},"vm.$mount")," \u65b9\u6cd5\u5c06\u751f\u547d\u5468\u671f\u63a8\u5165 Mount \u9636\u6bb5\u3002"),Object(i.b)("h2",{id:"vue-\u5b9e\u4f8b\u6302\u8f7d"},"Vue \u5b9e\u4f8b\u6302\u8f7d"),Object(i.b)("p",null,"Vue \u4e2d\u6211\u4eec\u662f\u901a\u8fc7 $mount \u5b9e\u4f8b\u65b9\u6cd5\u53bb\u6302\u8f7d vm \u7684\uff0c\u7531\u4e8e\u865a\u62df DOM \u7f16\u8bd1\u540e\u53ef\u4ee5\u5728\u4e0d\u540c\u5e73\u53f0\u8fd0\u884c\uff0c\u56e0\u6b64\u8fd9\u4e2a\u65b9\u6cd5\u5728\u4e0d\u540c\u5e73\u53f0\u6709\u4e0d\u540c\u7684\u5b9a\u4e49\u3002\u6211\u4eec\u6765\u770b\u6700\u5e38\u7528\u7684\u5b9a\u4e49\uff1a"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-js",metastring:'title="src/platform/web/entry-runtime-with-compiler.js"',title:'"src/platform/web/entry-runtime-with-compiler.js"'},"const mount = Vue.prototype.$mount;\nVue.prototype.$mount = function (el?: string | Element, hydrating?: boolean): Component {\n  el = el && query(el);\n\n  /* istanbul ignore if */\n  if (el === document.body || el === document.documentElement) {\n    process.env.NODE_ENV !== 'production' &&\n      warn(`Do not mount Vue to <html> or <body> - mount to normal elements instead.`);\n    return this;\n  }\n\n  const options = this.$options;\n  // resolve template/el and convert to render function\n  if (!options.render) {\n    let template = options.template;\n    if (template) {\n      if (typeof template === 'string') {\n        if (template.charAt(0) === '#') {\n          template = idToTemplate(template);\n        }\n      } else if (template.nodeType) {\n        template = template.innerHTML;\n      } else {\n        if (process.env.NODE_ENV !== 'production') {\n          warn('invalid template option:' + template, this);\n        }\n        return this;\n      }\n    } else if (el) {\n      template = getOuterHTML(el);\n    }\n    if (template) {\n      /* istanbul ignore if */\n      if (process.env.NODE_ENV !== 'production' && config.performance && mark) {\n        mark('compile');\n      }\n\n      // highlight-start\n      const { render, staticRenderFns } = compileToFunctions(\n        template,\n        {\n          shouldDecodeNewlines,\n          shouldDecodeNewlinesForHref,\n          delimiters: options.delimiters,\n          comments: options.comments,\n        },\n        this\n      );\n      options.render = render;\n      options.staticRenderFns = staticRenderFns;\n      // highlight-end\n\n      /* istanbul ignore if */\n      if (process.env.NODE_ENV !== 'production' && config.performance && mark) {\n        mark('compile end');\n        measure(`vue ${this._name} compile`, 'compile', 'compile end');\n      }\n    }\n  }\n  return mount.call(this, el, hydrating);\n};\n")),Object(i.b)("p",null,"\u8fd9\u6bb5\u4ee3\u7801\u7f13\u5b58\u4e86\u539f\u578b\u4e0a\u7684 ",Object(i.b)("inlineCode",{parentName:"p"},"$mount")," \u65b9\u6cd5\uff0c\u518d\u91cd\u65b0\u5b9a\u4e49\u8be5\u65b9\u6cd5\u3002\u5173\u952e\u7684\u903b\u8f91\u662f\uff0c\u5982\u679c\u6ca1\u6709\u5b9a\u4e49 render \u65b9\u6cd5\uff0c\u5219\u4f1a\u628a el/template \u5b57\u7b26\u4e32\u8f6c\u6362\u6210 render \u65b9\u6cd5\u3002\u6700\u540e\u8c03\u7528\u539f\u578b\u4e0a ",Object(i.b)("inlineCode",{parentName:"p"},"$mount")," \u65b9\u6cd5\u6302\u8f7d\u3002"),Object(i.b)("p",null,"\u539f\u578b\u4e0a\u7684 ",Object(i.b)("inlineCode",{parentName:"p"},"$mount")," \u65b9\u6cd5\u5b9a\u4e49\uff1a"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-js",metastring:'title="src/platform/web/runtime/index.js"',title:'"src/platform/web/runtime/index.js"'},"// public mount method\nVue.prototype.$mount = function (el?: string | Element, hydrating?: boolean): Component {\n  el = el && inBrowser ? query(el) : undefined;\n  // highlight-next-line\n  return mountComponent(this, el, hydrating);\n};\n")),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"$mount")," \u65b9\u6cd5\u6700\u7ec8\u4f1a\u8c03\u7528 ",Object(i.b)("inlineCode",{parentName:"p"},"mountComponent")," \u65b9\u6cd5\uff1a"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-js",metastring:'title="src/core/instance/lifecycle.js"',title:'"src/core/instance/lifecycle.js"'},"export function mountComponent(vm: Component, el: ?Element, hydrating?: boolean): Component {\n  vm.$el = el;\n  if (!vm.$options.render) {\n    vm.$options.render = createEmptyVNode;\n    // ...\n  }\n  callHook(vm, 'beforeMount');\n\n  // highlight-start\n  let updateComponent = () => {\n    vm._update(vm._render(), hydrating);\n  };\n  // highlight-end\n\n  // we set this to vm._watcher inside the watcher's constructor\n  // since the watcher's initial patch may call $forceUpdate (e.g. inside child\n  // component's mounted hook), which relies on vm._watcher being already defined\n  // highlight-start\n  new Watcher(\n    vm,\n    updateComponent,\n    noop,\n    {\n      before() {\n        if (vm._isMounted) {\n          callHook(vm, 'beforeUpdate');\n        }\n      },\n    },\n    true /* isRenderWatcher */\n  );\n  // highlight-end\n  hydrating = false;\n\n  // manually mounted instance, call mounted on self\n  // mounted is called for render-created child components in its inserted hook\n  if (vm.$vnode == null) {\n    vm._isMounted = true;\n    // highlight-next-line\n    callHook(vm, 'mounted');\n  }\n  return vm;\n}\n")),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"mountComponent")," \u6838\u5fc3\u5c31\u662f\u5148\u5b9e\u4f8b\u5316\u4e00\u4e2a\u6e32\u67d3 ",Object(i.b)("inlineCode",{parentName:"p"},"Watcher"),"\uff0c\u5728\u5b83\u7684\u56de\u8c03\u51fd\u6570\u4e2d\u4f1a\u8c03\u7528 ",Object(i.b)("inlineCode",{parentName:"p"},"updateComponent")," \u65b9\u6cd5\uff0c\u5728\u6b64\u65b9\u6cd5\u4e2d\u8c03\u7528 ",Object(i.b)("inlineCode",{parentName:"p"},"vm._render")," \u65b9\u6cd5\u5148\u751f\u6210\u865a\u62df Node\uff0c\u6700\u7ec8\u8c03\u7528 ",Object(i.b)("inlineCode",{parentName:"p"},"vm._update")," \u66f4\u65b0 DOM\u3002"),Object(i.b)("h2",{id:"render"},"render"),Object(i.b)("p",null,"Vue \u7684 ",Object(i.b)("inlineCode",{parentName:"p"},"_render")," \u65b9\u6cd5\u662f\u5b9e\u4f8b\u7684\u4e00\u4e2a\u79c1\u6709\u65b9\u6cd5\uff0c\u5b83\u7528\u6765\u628a\u5b9e\u4f8b\u6e32\u67d3\u6210\u4e00\u4e2a\u865a\u62df\u8282\u70b9\u3002"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-js",metastring:'title="src/core/instance/render.js"',title:'"src/core/instance/render.js"'},"Vue.prototype._render = function (): VNode {\n  const vm: Component = this;\n  const { render, _parentVnode } = vm.$options;\n\n  // reset _rendered flag on slots for duplicate slot check\n  if (process.env.NODE_ENV !== 'production') {\n    for (const key in vm.$slots) {\n      // $flow-disable-line\n      vm.$slots[key]._rendered = false;\n    }\n  }\n\n  if (_parentVnode) {\n    vm.$scopedSlots = _parentVnode.data.scopedSlots || emptyObject;\n  }\n\n  // set parent vnode. this allows render functions to have access\n  // to the data on the placeholder node.\n  vm.$vnode = _parentVnode;\n  // render self\n  let vnode;\n  try {\n    // highlight-next-line\n    vnode = render.call(vm._renderProxy, vm.$createElement);\n  } catch (e) {\n    handleError(e, vm, `render`);\n    // return error render result,\n    // or previous vnode to prevent render error causing blank component\n    /* istanbul ignore else */\n    if (process.env.NODE_ENV !== 'production') {\n      if (vm.$options.renderError) {\n        try {\n          vnode = vm.$options.renderError.call(vm._renderProxy, vm.$createElement, e);\n        } catch (e) {\n          handleError(e, vm, `renderError`);\n          vnode = vm._vnode;\n        }\n      } else {\n        vnode = vm._vnode;\n      }\n    } else {\n      vnode = vm._vnode;\n    }\n  }\n  // return empty vnode in case the render function errored out\n  if (!(vnode instanceof VNode)) {\n    if (process.env.NODE_ENV !== 'production' && Array.isArray(vnode)) {\n      warn(\n        'Multiple root nodes returned from render function. Render function ' +\n          'should return a single root node.',\n        vm\n      );\n    }\n    vnode = createEmptyVNode();\n  }\n  // set parent\n  vnode.parent = _parentVnode;\n  // highlight-next-line\n  return vnode;\n};\n")),Object(i.b)("p",null,"\u53ef\u4ee5\u770b\u5230\uff0c",Object(i.b)("inlineCode",{parentName:"p"},"render")," \u51fd\u6570\u4e2d\u7684 ",Object(i.b)("inlineCode",{parentName:"p"},"createElement")," \u65b9\u6cd5\u5c31\u662f ",Object(i.b)("inlineCode",{parentName:"p"},"vm.$createElement")," \u65b9\u6cd5\uff1a"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-js"},"export function initRender(vm: Component) {\n  // ...\n  // bind the createElement fn to this instance\n  // so that we get proper render context inside it.\n  // args order: tag, data, children, normalizationType, alwaysNormalize\n  // internal version is used by render functions compiled from templates\n  vm._c = (a, b, c, d) => createElement(vm, a, b, c, d, false);\n  // normalization is always applied for the public version, used in\n  // user-written render functions.\n  vm.$createElement = (a, b, c, d) => createElement(vm, a, b, c, d, true);\n}\n")),Object(i.b)("h2",{id:"virtual-dom"},"Virtual DOM"),Object(i.b)("p",null,"\u771f\u6b63\u7684 DOM \u5143\u7d20\u662f\u975e\u5e38\u5e9e\u5927\u7684\uff0c\u56e0\u4e3a\u6d4f\u89c8\u5668\u7684\u6807\u51c6\u5c31\u628a DOM \u8bbe\u8ba1\u7684\u975e\u5e38\u590d\u6742\u3002\u5f53\u6211\u4eec\u9891\u7e41\u7684\u53bb\u505a DOM \u66f4\u65b0\uff0c\u4f1a\u4ea7\u751f\u4e00\u5b9a\u7684\u6027\u80fd\u95ee\u9898\u3002"),Object(i.b)("p",null,"\u800c Virtual DOM \u5c31\u662f\u7528\u4e00\u4e2a\u539f\u751f\u7684 JS \u5bf9\u8c61\u53bb\u63cf\u8ff0\u4e00\u4e2a DOM \u8282\u70b9\uff0c\u6240\u4ee5\u5b83\u6bd4\u521b\u5efa\u4e00\u4e2a DOM \u7684\u4ee3\u4ef7\u8981\u5c0f\u5f88\u591a\u3002\u5728 Vue.js \u4e2d\uff0cVirtual DOM \u662f\u7528 ",Object(i.b)("inlineCode",{parentName:"p"},"VNode")," \u8fd9\u4e48\u4e00\u4e2a Class \u53bb\u63cf\u8ff0\u3002"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-js",metastring:'title="src/core/vdom/vnode.js"',title:'"src/core/vdom/vnode.js"'},"export default class VNode {\n  tag: string | void;\n  data: VNodeData | void;\n  children: ?Array<VNode>;\n  text: string | void;\n  elm: Node | void;\n  ns: string | void;\n  context: Component | void; // rendered in this component's scope\n  key: string | number | void;\n  componentOptions: VNodeComponentOptions | void;\n  componentInstance: Component | void; // component instance\n  parent: VNode | void; // component placeholder node\n\n  // strictly internal\n  raw: boolean; // contains raw HTML? (server only)\n  isStatic: boolean; // hoisted static node\n  isRootInsert: boolean; // necessary for enter transition check\n  isComment: boolean; // empty comment placeholder?\n  isCloned: boolean; // is a cloned node?\n  isOnce: boolean; // is a v-once node?\n  asyncFactory: Function | void; // async component factory function\n  asyncMeta: Object | void;\n  isAsyncPlaceholder: boolean;\n  ssrContext: Object | void;\n  fnContext: Component | void; // real context vm for functional nodes\n  fnOptions: ?ComponentOptions; // for SSR caching\n  fnScopeId: ?string; // functional scope id support\n\n  constructor(\n    tag?: string,\n    data?: VNodeData,\n    children?: ?Array<VNode>,\n    text?: string,\n    elm?: Node,\n    context?: Component,\n    componentOptions?: VNodeComponentOptions,\n    asyncFactory?: Function\n  ) {\n    this.tag = tag;\n    this.data = data;\n    this.children = children;\n    this.text = text;\n    this.elm = elm;\n    this.ns = undefined;\n    this.context = context;\n    this.fnContext = undefined;\n    this.fnOptions = undefined;\n    this.fnScopeId = undefined;\n    this.key = data && data.key;\n    this.componentOptions = componentOptions;\n    this.componentInstance = undefined;\n    this.parent = undefined;\n    this.raw = false;\n    this.isStatic = false;\n    this.isRootInsert = true;\n    this.isComment = false;\n    this.isCloned = false;\n    this.isOnce = false;\n    this.asyncFactory = asyncFactory;\n    this.asyncMeta = undefined;\n    this.isAsyncPlaceholder = false;\n  }\n\n  // DEPRECATED: alias for componentInstance for backwards compat.\n  /* istanbul ignore next */\n  get child(): Component | void {\n    return this.componentInstance;\n  }\n}\n")),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"Vue.js \u4e2d Virtual DOM \u662f\u501f\u9274\u4e86\u4e00\u4e2a\u5f00\u6e90\u5e93 ",Object(i.b)("a",{parentName:"p",href:"https://github.com/snabbdom/snabbdom"},"snabbdom")," \u7684\u5b9e\u73b0\uff0c\u7136\u540e\u52a0\u5165\u4e86\u4e00\u4e9b Vue.js \u7279\u8272\u7684\u4e1c\u897f\u3002")),Object(i.b)("p",null,"\u5176\u5b9e VNode \u662f\u5bf9\u771f\u5b9e DOM \u7684\u4e00\u79cd\u62bd\u8c61\u63cf\u8ff0\uff0c\u5b83\u7684\u6838\u5fc3\u5b9a\u4e49\u65e0\u975e\u5c31\u51e0\u4e2a\u5173\u952e\u5c5e\u6027\uff0c\u6807\u7b7e\u540d\u3001\u6570\u636e\u3001\u5b50\u8282\u70b9\u3001\u952e\u503c\u7b49\uff0c\u5176\u5b83\u5c5e\u6027\u90fd\u662f\u7528\u6765\u6269\u5c55 VNode \u7684\u7075\u6d3b\u6027\u4ee5\u53ca\u5b9e\u73b0\u4e00\u4e9b\u7279\u6b8a feature \u7684\u3002\u7531\u4e8e VNode \u53ea\u662f\u7528\u6765\u6620\u5c04\u5230\u771f\u5b9e DOM \u7684\u6e32\u67d3\uff0c\u4e0d\u9700\u8981\u5305\u542b\u64cd\u4f5c DOM \u7684\u65b9\u6cd5\uff0c\u56e0\u6b64\u5b83\u662f\u975e\u5e38\u8f7b\u91cf\u548c\u7b80\u5355\u7684\u3002"),Object(i.b)("p",null,"Virtual DOM \u9664\u4e86\u5b83\u7684\u6570\u636e\u7ed3\u6784\u7684\u5b9a\u4e49\uff0c\u6620\u5c04\u5230\u771f\u5b9e\u7684 DOM \u5b9e\u9645\u4e0a\u8981\u7ecf\u5386 VNode \u7684 create\u3001diff\u3001patch \u7b49\u8fc7\u7a0b\u3002\u90a3\u4e48\u5728 Vue.js \u4e2d\uff0cVNode \u7684 create \u662f\u901a\u8fc7 ",Object(i.b)("inlineCode",{parentName:"p"},"createElement")," \u65b9\u6cd5\u521b\u5efa\u7684\uff0c\u6211\u4eec\u63a5\u4e0b\u6765\u5206\u6790\u8fd9\u90e8\u5206\u7684\u5b9e\u73b0\u3002"),Object(i.b)("h2",{id:"createelement"},"createElement"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-js",metastring:'title="src/core/vdom/create-element.js"',title:'"src/core/vdom/create-element.js"'},"// wrapper function for providing a more flexible interface\n// without getting yelled at by flow\nexport function createElement(\n  context: Component,\n  tag: any,\n  data: any,\n  children: any,\n  normalizationType: any,\n  alwaysNormalize: boolean\n): VNode | Array<VNode> {\n  if (Array.isArray(data) || isPrimitive(data)) {\n    normalizationType = children;\n    children = data;\n    data = undefined;\n  }\n  if (isTrue(alwaysNormalize)) {\n    normalizationType = ALWAYS_NORMALIZE;\n  }\n  // highlight-next-line\n  return _createElement(context, tag, data, children, normalizationType);\n}\n")),Object(i.b)("p",null,"\u5b9e\u9645\u4e0a\uff0c",Object(i.b)("inlineCode",{parentName:"p"},"_createElement")," \u624d\u662f\u771f\u6b63\u521b\u5efa VNode \u7684\u65b9\u6cd5\u3002"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-js",metastring:'title=""',title:'""'},"export function _createElement(\n  context: Component,\n  tag?: string | Class<Component> | Function | Object,\n  data?: VNodeData,\n  children?: any,\n  normalizationType?: number\n): VNode | Array<VNode> {\n  if (isDef(data) && isDef((data: any).__ob__)) {\n    // ...\n    return createEmptyVNode();\n  }\n  // object syntax in v-bind\n  if (isDef(data) && isDef(data.is)) {\n    tag = data.is;\n  }\n  if (!tag) {\n    // in case of component :is set to falsy value\n    return createEmptyVNode();\n  }\n  // warn against non-primitive key\n  //...\n\n  // support single function children as default scoped slot\n  if (Array.isArray(children) && typeof children[0] === 'function') {\n    data = data || {};\n    data.scopedSlots = { default: children[0] };\n    children.length = 0;\n  }\n  // highlight-start\n  if (normalizationType === ALWAYS_NORMALIZE) {\n    children = normalizeChildren(children);\n  } else if (normalizationType === SIMPLE_NORMALIZE) {\n    children = simpleNormalizeChildren(children);\n  }\n  // highlight-end\n  let vnode, ns;\n  if (typeof tag === 'string') {\n    let Ctor;\n    ns = (context.$vnode && context.$vnode.ns) || config.getTagNamespace(tag);\n    if (config.isReservedTag(tag)) {\n      // platform built-in elements\n      // highlight-start\n      vnode = new VNode(\n        config.parsePlatformTagName(tag),\n        data,\n        children,\n        undefined,\n        undefined,\n        context\n      );\n      // highlight-end\n    } else if (isDef((Ctor = resolveAsset(context.$options, 'components', tag)))) {\n      // component\n      // highlight-next-line\n      vnode = createComponent(Ctor, data, context, children, tag);\n    } else {\n      // unknown or unlisted namespaced elements\n      // check at runtime because it may get assigned a namespace when its\n      // parent normalizes children\n      // highlight-next-line\n      vnode = new VNode(tag, data, children, undefined, undefined, context);\n    }\n  } else {\n    // direct component options / constructor\n    // highlight-next-line\n    vnode = createComponent(tag, data, context, children);\n  }\n  if (Array.isArray(vnode)) {\n    return vnode;\n  } else if (isDef(vnode)) {\n    if (isDef(ns)) applyNS(vnode, ns);\n    if (isDef(data)) registerDeepBindings(data);\n    return vnode;\n  } else {\n    return createEmptyVNode();\n  }\n}\n")),Object(i.b)("h3",{id:"children-\u7684\u89c4\u8303\u5316"},"children \u7684\u89c4\u8303\u5316"),Object(i.b)("p",null,"\u7531\u4e8e Virtual DOM \u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u6811\u72b6\u7ed3\u6784\uff0c\u6bcf\u4e00\u4e2a VNode \u53ef\u80fd\u4f1a\u6709\u82e5\u5e72\u4e2a\u5b50\u8282\u70b9\uff0c\u8fd9\u4e9b\u5b50\u8282\u70b9\u5e94\u8be5\u4e5f\u662f VNode \u7684\u7c7b\u578b\u3002",Object(i.b)("inlineCode",{parentName:"p"},"_createElement")," \u63a5\u6536\u7684\u7b2c 4 \u4e2a\u53c2\u6570 children \u662f\u4efb\u610f\u7c7b\u578b\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u628a\u5b83\u4eec\u89c4\u8303\u6210 VNode \u7c7b\u578b\u3002"),Object(i.b)("p",null,"\u8fd9\u91cc\u6839\u636e ",Object(i.b)("inlineCode",{parentName:"p"},"normalizationType")," \u7684\u4e0d\u540c\uff0c\u8c03\u7528\u4e86 ",Object(i.b)("inlineCode",{parentName:"p"},"normalizeChildren")," \u548c ",Object(i.b)("inlineCode",{parentName:"p"},"simpleNormalizeChildren")," \u65b9\u6cd5\u3002"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-js",metastring:'title=""',title:'""'},"// The template compiler attempts to minimize the need for normalization by\n// statically analyzing the template at compile time.\n//\n// For plain HTML markup, normalization can be completely skipped because the\n// generated render function is guaranteed to return Array<VNode>. There are\n// two cases where extra normalization is needed:\n\n// 1. When the children contains components - because a functional component\n// may return an Array instead of a single root. In this case, just a simple\n// normalization is needed - if any child is an Array, we flatten the whole\n// thing with Array.prototype.concat. It is guaranteed to be only 1-level deep\n// because functional components already normalize their own children.\nexport function simpleNormalizeChildren(children: any) {\n  for (let i = 0; i < children.length; i++) {\n    if (Array.isArray(children[i])) {\n      return Array.prototype.concat.apply([], children);\n    }\n  }\n  return children;\n}\n\n// 2. When the children contains constructs that always generated nested Arrays,\n// e.g. <template>, <slot>, v-for, or when the children is provided by user\n// with hand-written render functions / JSX. In such cases a full normalization\n// is needed to cater to all possible types of children values.\nexport function normalizeChildren(children: any): ?Array<VNode> {\n  return isPrimitive(children)\n    ? [createTextVNode(children)]\n    : Array.isArray(children)\n    ? normalizeArrayChildren(children)\n    : undefined;\n}\n")),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"simpleNormalizeChildren")," \u65b9\u6cd5\u8c03\u7528\u573a\u666f\u662f ",Object(i.b)("inlineCode",{parentName:"p"},"render")," \u51fd\u6570\u662f\u7f16\u8bd1\u751f\u6210\u7684\u3002\u7406\u8bba\u4e0a\u7f16\u8bd1\u751f\u6210\u7684 children \u90fd\u5df2\u7ecf\u662f VNode \u7c7b\u578b\u7684\uff0c\u4f46\u8fd9\u91cc\u6709\u4e00\u4e2a\u4f8b\u5916\uff0c\u5c31\u662f ",Object(i.b)("inlineCode",{parentName:"p"},"functional component")," \u51fd\u6570\u5f0f\u7ec4\u4ef6\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u6570\u7ec4\u800c\u4e0d\u662f\u4e00\u4e2a\u6839\u8282\u70b9\uff0c\u6240\u4ee5\u4f1a\u901a\u8fc7 ",Object(i.b)("inlineCode",{parentName:"p"},"Array.prototype.concat")," \u65b9\u6cd5\u628a\u6574\u4e2a children \u6570\u7ec4\u6253\u5e73\uff0c\u8ba9\u5b83\u7684\u6df1\u5ea6\u53ea\u6709\u4e00\u5c42\u3002"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"normalizeChildren")," \u65b9\u6cd5\u7684\u8c03\u7528\u573a\u666f\u6709 2 \u79cd\uff0c\u4e00\u4e2a\u573a\u666f\u662f render \u51fd\u6570\u662f\u7528\u6237\u624b\u5199\u7684\uff0c\u5f53 children \u53ea\u6709\u4e00\u4e2a\u8282\u70b9\u7684\u65f6\u5019\uff0cVue.js \u4ece\u63a5\u53e3\u5c42\u9762\u5141\u8bb8\u7528\u6237\u628a children \u5199\u6210\u57fa\u7840\u7c7b\u578b\u7528\u6765\u521b\u5efa\u5355\u4e2a\u7b80\u5355\u7684\u6587\u672c\u8282\u70b9\uff0c\u8fd9\u79cd\u60c5\u51b5\u4f1a\u8c03\u7528 ",Object(i.b)("inlineCode",{parentName:"p"},"createTextVNode")," \u521b\u5efa\u4e00\u4e2a\u6587\u672c\u8282\u70b9\u7684 VNode\uff1b\u53e6\u4e00\u4e2a\u573a\u666f\u662f\u5f53\u7f16\u8bd1 ",Object(i.b)("inlineCode",{parentName:"p"},"slot"),"\u3001",Object(i.b)("inlineCode",{parentName:"p"},"v-for")," \u7684\u65f6\u5019\u4f1a\u4ea7\u751f\u5d4c\u5957\u6570\u7ec4\u7684\u60c5\u51b5\uff0c\u4f1a\u8c03\u7528 ",Object(i.b)("inlineCode",{parentName:"p"},"normalizeArrayChildren")," \u65b9\u6cd5\u3002"),Object(i.b)("p",null,"\u7ecf\u8fc7\u5bf9 children \u7684\u89c4\u8303\u5316\uff0cchildren \u53d8\u6210\u4e86\u4e00\u4e2a\u7c7b\u578b\u4e3a VNode \u7684\u6570\u7ec4\u3002"),Object(i.b)("h3",{id:"vnode-\u7684\u521b\u5efa"},"VNode \u7684\u521b\u5efa"),Object(i.b)("p",null,"\u8fd9\u91cc\u5148\u5bf9 ",Object(i.b)("inlineCode",{parentName:"p"},"tag")," \u505a\u5224\u65ad\uff1a"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"\u5982\u679c\u662f string \u7c7b\u578b\uff0c\u5219\u63a5\u7740\u5224\u65ad\u5982\u679c\u662f\u5185\u7f6e\u7684\u4e00\u4e9b\u8282\u70b9\uff0c\u5219\u76f4\u63a5\u521b\u5efa\u4e00\u4e2a\u666e\u901a VNode\uff1b\u5982\u679c\u662f\u4e3a\u5df2\u6ce8\u518c\u7684\u7ec4\u4ef6\u540d\uff0c\u5219\u901a\u8fc7 ",Object(i.b)("inlineCode",{parentName:"li"},"createComponent")," \u521b\u5efa\u4e00\u4e2a\u7ec4\u4ef6\u7c7b\u578b\u7684 VNode\uff1b\u5426\u5219\u521b\u5efa\u4e00\u4e2a\u672a\u77e5\u7684\u6807\u7b7e\u7684 VNode\u3002"),Object(i.b)("li",{parentName:"ul"},"\u5982\u679c\u662f Component \u7c7b\u578b\uff0c\u5219\u76f4\u63a5\u8c03\u7528 ",Object(i.b)("inlineCode",{parentName:"li"},"createComponent")," \u521b\u5efa\u4e00\u4e2a\u7ec4\u4ef6\u7c7b\u578b\u7684 VNode \u8282\u70b9\u3002")))}s.isMDXComponent=!0}}]);