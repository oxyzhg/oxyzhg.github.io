(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{118:function(e,n,t){"use strict";t.d(n,"a",(function(){return p})),t.d(n,"b",(function(){return b}));var o=t(0),i=t.n(o);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function d(e,n){if(null==e)return{};var t,o,i=function(e,n){if(null==e)return{};var t,o,i={},r=Object.keys(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var c=i.a.createContext({}),s=function(e){var n=i.a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},p=function(e){var n=s(e.components);return i.a.createElement(c.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return i.a.createElement(i.a.Fragment,{},n)}},u=i.a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,a=e.parentName,c=d(e,["components","mdxType","originalType","parentName"]),p=s(t),u=o,b=p["".concat(a,".").concat(u)]||p[u]||m[u]||r;return t?i.a.createElement(b,l(l({ref:n},c),{},{components:t})):i.a.createElement(b,l({ref:n},c))}));function b(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,a=new Array(r);a[0]=u;var l={};for(var d in n)hasOwnProperty.call(n,d)&&(l[d]=n[d]);l.originalType=e,l.mdxType="string"==typeof e?e:o,a[1]=l;for(var c=2;c<r;c++)a[c]=t[c];return i.a.createElement.apply(null,a)}return i.a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},158:function(e,n,t){"use strict";t.r(n),n.default=t.p+"assets/images/new-vue-e0a06455e3239c7b107f6c7f5dbf4294.png"},63:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return a})),t.d(n,"metadata",(function(){return l})),t.d(n,"toc",(function(){return d})),t.d(n,"default",(function(){return s}));var o=t(3),i=t(7),r=(t(0),t(118)),a={id:"data-driven",title:"\u6570\u636e\u9a71\u52a8"},l={unversionedId:"advanced/vue/data-driven",id:"advanced/vue/data-driven",isDocsHomePage:!1,title:"\u6570\u636e\u9a71\u52a8",description:"Vue.js \u4e00\u4e2a\u6838\u5fc3\u601d\u60f3\u662f\u6570\u636e\u9a71\u52a8\u3002\u6240\u8c13\u6570\u636e\u9a71\u52a8\uff0c\u662f\u6307\u89c6\u56fe\u662f\u7531\u6570\u636e\u9a71\u52a8\u751f\u6210\u7684\uff0c\u6211\u4eec\u5bf9\u89c6\u56fe\u7684\u4fee\u6539\uff0c\u4e0d\u4f1a\u76f4\u63a5\u64cd\u4f5c DOM\uff0c\u800c\u662f\u901a\u8fc7\u4fee\u6539\u6570\u636e\u3002\u7279\u522b\u662f\u5f53\u4ea4\u4e92\u590d\u6742\u7684\u65f6\u5019\uff0c\u53ea\u5173\u5fc3\u6570\u636e\u7684\u4fee\u6539\u4f1a\u8ba9\u4ee3\u7801\u7684\u903b\u8f91\u53d8\u7684\u975e\u5e38\u6e05\u6670\uff0c\u56e0\u4e3a DOM \u53d8\u6210\u4e86\u6570\u636e\u7684\u6620\u5c04\uff0c\u6211\u4eec\u6240\u6709\u7684\u903b\u8f91\u90fd\u662f\u5bf9\u6570\u636e\u7684\u4fee\u6539\uff0c\u800c\u4e0d\u7528\u78b0\u89e6 DOM\uff0c\u8fd9\u6837\u7684\u4ee3\u7801\u975e\u5e38\u5229\u4e8e\u7ef4\u62a4\u3002\u8fd9\u53ef\u4ee5\u770b\u4f5c\u662f\u662f MVVM \u4e2d binder \u7684\u5b9e\u73b0\u3002",source:"@site/docs/advanced/vue/data-driven.md",slug:"/advanced/vue/data-driven",permalink:"/fex/docs/advanced/vue/data-driven",editUrl:"https://github.com/oxyzhg/fex/edit/main/docs/advanced/vue/data-driven.md",version:"current",sidebar:"advanced",previous:{title:"\u6982\u89c8",permalink:"/fex/docs/advanced/vue"},next:{title:"\u7ec4\u4ef6\u5316",permalink:"/fex/docs/advanced/vue/componentization"}},d=[{value:"new Vue \u53d1\u751f\u4e86\u4ec0\u4e48",id:"new-vue-\u53d1\u751f\u4e86\u4ec0\u4e48",children:[]},{value:"Vue \u5b9e\u4f8b\u6302\u8f7d",id:"vue-\u5b9e\u4f8b\u6302\u8f7d",children:[]},{value:"render",id:"render",children:[]},{value:"Virtual DOM",id:"virtual-dom",children:[]},{value:"createElement",id:"createelement",children:[{value:"children \u7684\u89c4\u8303\u5316",id:"children-\u7684\u89c4\u8303\u5316",children:[]},{value:"VNode \u7684\u521b\u5efa",id:"vnode-\u7684\u521b\u5efa",children:[]}]},{value:"update",id:"update",children:[{value:"createElm",id:"createelm",children:[]},{value:"createChildren",id:"createchildren",children:[]}]},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",children:[]}],c={toc:d};function s(e){var n=e.components,a=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(o.a)({},c,a,{components:n,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Vue.js \u4e00\u4e2a\u6838\u5fc3\u601d\u60f3\u662f\u6570\u636e\u9a71\u52a8\u3002\u6240\u8c13\u6570\u636e\u9a71\u52a8\uff0c\u662f\u6307\u89c6\u56fe\u662f\u7531\u6570\u636e\u9a71\u52a8\u751f\u6210\u7684\uff0c\u6211\u4eec\u5bf9\u89c6\u56fe\u7684\u4fee\u6539\uff0c\u4e0d\u4f1a\u76f4\u63a5\u64cd\u4f5c DOM\uff0c\u800c\u662f\u901a\u8fc7\u4fee\u6539\u6570\u636e\u3002\u7279\u522b\u662f\u5f53\u4ea4\u4e92\u590d\u6742\u7684\u65f6\u5019\uff0c\u53ea\u5173\u5fc3\u6570\u636e\u7684\u4fee\u6539\u4f1a\u8ba9\u4ee3\u7801\u7684\u903b\u8f91\u53d8\u7684\u975e\u5e38\u6e05\u6670\uff0c\u56e0\u4e3a DOM \u53d8\u6210\u4e86\u6570\u636e\u7684\u6620\u5c04\uff0c\u6211\u4eec\u6240\u6709\u7684\u903b\u8f91\u90fd\u662f\u5bf9\u6570\u636e\u7684\u4fee\u6539\uff0c\u800c\u4e0d\u7528\u78b0\u89e6 DOM\uff0c\u8fd9\u6837\u7684\u4ee3\u7801\u975e\u5e38\u5229\u4e8e\u7ef4\u62a4\u3002\u8fd9\u53ef\u4ee5\u770b\u4f5c\u662f\u662f MVVM \u4e2d binder \u7684\u5b9e\u73b0\u3002"),Object(r.b)("h2",{id:"new-vue-\u53d1\u751f\u4e86\u4ec0\u4e48"},"new Vue \u53d1\u751f\u4e86\u4ec0\u4e48"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js",metastring:'title="src/core/instance/index.js"',title:'"src/core/instance/index.js"'},"function Vue(options) {\n  if (process.env.NODE_ENV !== 'production' && !(this instanceof Vue)) {\n    warn('Vue is a constructor and should be called with the `new` keyword');\n  }\n  // highlight-next-line\n  this._init(options);\n}\n")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js",metastring:'title="src/core/instance/init.js"',title:'"src/core/instance/init.js"'},"Vue.prototype._init = function (options?: Object) {\n  const vm: Component = this;\n  // a uid\n  vm._uid = uid++;\n\n  let startTag, endTag;\n  /* istanbul ignore if */\n  if (process.env.NODE_ENV !== 'production' && config.performance && mark) {\n    startTag = `vue-perf-start:${vm._uid}`;\n    endTag = `vue-perf-end:${vm._uid}`;\n    mark(startTag);\n  }\n\n  // a flag to avoid this being observed\n  vm._isVue = true;\n  // merge options\n  if (options && options._isComponent) {\n    // optimize internal component instantiation\n    // since dynamic options merging is pretty slow, and none of the\n    // internal component options needs special treatment.\n    initInternalComponent(vm, options);\n  } else {\n    // highlight-next-line\n    vm.$options = mergeOptions(resolveConstructorOptions(vm.constructor), options || {}, vm);\n  }\n  /* istanbul ignore else */\n  if (process.env.NODE_ENV !== 'production') {\n    initProxy(vm);\n  } else {\n    vm._renderProxy = vm;\n  }\n  // expose real self\n  vm._self = vm;\n  // highlight-start\n  initLifecycle(vm);\n  initEvents(vm);\n  initRender(vm);\n  callHook(vm, 'beforeCreate');\n  initInjections(vm); // resolve injections before data/props\n  initState(vm);\n  initProvide(vm); // resolve provide after data/props\n  callHook(vm, 'created');\n  // highlight-end\n\n  /* istanbul ignore if */\n  if (process.env.NODE_ENV !== 'production' && config.performance && mark) {\n    vm._name = formatComponentName(vm, false);\n    mark(endTag);\n    measure(`vue ${vm._name} init`, startTag, endTag);\n  }\n\n  if (vm.$options.el) {\n    // highlight-next-line\n    vm.$mount(vm.$options.el);\n  }\n};\n")),Object(r.b)("p",null,"Vue \u521d\u59cb\u5316\u4e3b\u8981\u5c31\u5e72\u4e86\u51e0\u4ef6\u4e8b\u60c5\uff1a",Object(r.b)("strong",{parentName:"p"},"\u5408\u5e76\u914d\u7f6e\uff0c\u521d\u59cb\u5316\u751f\u547d\u5468\u671f\uff0c\u521d\u59cb\u5316\u4e8b\u4ef6\u4e2d\u5fc3\uff0c\u521d\u59cb\u5316\u6e32\u67d3\uff0c\u521d\u59cb\u5316 data\u3001props\u3001computed\u3001watcher \u7b49"),"\u3002"),Object(r.b)("p",null,"\u7136\u540e\uff0c\u6267\u884c ",Object(r.b)("inlineCode",{parentName:"p"},"vm.$mount")," \u65b9\u6cd5\u5c06\u751f\u547d\u5468\u671f\u63a8\u5165 Mount \u9636\u6bb5\u3002"),Object(r.b)("h2",{id:"vue-\u5b9e\u4f8b\u6302\u8f7d"},"Vue \u5b9e\u4f8b\u6302\u8f7d"),Object(r.b)("p",null,"Vue \u4e2d\u6211\u4eec\u662f\u901a\u8fc7 ",Object(r.b)("inlineCode",{parentName:"p"},"$mount")," \u5b9e\u4f8b\u65b9\u6cd5\u53bb\u6302\u8f7d vm \u7684\uff0c\u7531\u4e8e\u865a\u62df DOM \u7f16\u8bd1\u540e\u53ef\u4ee5\u5728\u4e0d\u540c\u5e73\u53f0\u8fd0\u884c\uff0c\u56e0\u6b64\u5e73\u53f0\u4e0d\u540c\u5b9a\u4e49\u5b58\u5728\u5dee\u5f02\u3002\u6211\u4eec\u6765\u770b\u5e38\u89c1\u7684 web \u5e73\u53f0\u7684\u5b9a\u4e49\uff1a"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js",metastring:'title="src/platform/web/entry-runtime-with-compiler.js"',title:'"src/platform/web/entry-runtime-with-compiler.js"'},"const mount = Vue.prototype.$mount;\nVue.prototype.$mount = function (el?: string | Element, hydrating?: boolean): Component {\n  el = el && query(el);\n\n  /* istanbul ignore if */\n  if (el === document.body || el === document.documentElement) {\n    process.env.NODE_ENV !== 'production' &&\n      warn(`Do not mount Vue to <html> or <body> - mount to normal elements instead.`);\n    return this;\n  }\n\n  const options = this.$options;\n  // resolve template/el and convert to render function\n  if (!options.render) {\n    let template = options.template;\n    if (template) {\n      if (typeof template === 'string') {\n        if (template.charAt(0) === '#') {\n          template = idToTemplate(template);\n        }\n      } else if (template.nodeType) {\n        template = template.innerHTML;\n      } else {\n        if (process.env.NODE_ENV !== 'production') {\n          warn('invalid template option:' + template, this);\n        }\n        return this;\n      }\n    } else if (el) {\n      template = getOuterHTML(el);\n    }\n    if (template) {\n      /* istanbul ignore if */\n      if (process.env.NODE_ENV !== 'production' && config.performance && mark) {\n        mark('compile');\n      }\n\n      // highlight-start\n      const { render, staticRenderFns } = compileToFunctions(\n        template,\n        {\n          shouldDecodeNewlines,\n          shouldDecodeNewlinesForHref,\n          delimiters: options.delimiters,\n          comments: options.comments,\n        },\n        this\n      );\n      options.render = render;\n      options.staticRenderFns = staticRenderFns;\n      // highlight-end\n\n      /* istanbul ignore if */\n      if (process.env.NODE_ENV !== 'production' && config.performance && mark) {\n        mark('compile end');\n        measure(`vue ${this._name} compile`, 'compile', 'compile end');\n      }\n    }\n  }\n  return mount.call(this, el, hydrating);\n};\n")),Object(r.b)("p",null,"\u8fd9\u6bb5\u4ee3\u7801\u7f13\u5b58\u4e86\u539f\u578b\u4e0a\u7684 ",Object(r.b)("inlineCode",{parentName:"p"},"$mount")," \u65b9\u6cd5\uff0c\u518d\u91cd\u65b0\u5b9a\u4e49\u8be5\u65b9\u6cd5\u3002\u5173\u952e\u7684\u903b\u8f91\u662f\uff0c\u5982\u679c\u6ca1\u6709\u5b9a\u4e49 render \u65b9\u6cd5\uff0c\u5219\u4f1a\u628a el/template \u5b57\u7b26\u4e32\u8f6c\u6362\u6210 render \u65b9\u6cd5\u3002\u6700\u540e\u8c03\u7528\u539f\u578b\u4e0a ",Object(r.b)("inlineCode",{parentName:"p"},"$mount")," \u65b9\u6cd5\u6302\u8f7d\u3002"),Object(r.b)("p",null,"\u539f\u578b\u4e0a\u7684 ",Object(r.b)("inlineCode",{parentName:"p"},"$mount")," \u65b9\u6cd5\u5b9a\u4e49\uff1a"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js",metastring:'title="src/platform/web/runtime/index.js"',title:'"src/platform/web/runtime/index.js"'},"// public mount method\nVue.prototype.$mount = function (el?: string | Element, hydrating?: boolean): Component {\n  el = el && inBrowser ? query(el) : undefined;\n  // highlight-next-line\n  return mountComponent(this, el, hydrating);\n};\n")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"$mount")," \u65b9\u6cd5\u6700\u7ec8\u4f1a\u8c03\u7528 ",Object(r.b)("inlineCode",{parentName:"p"},"mountComponent")," \u65b9\u6cd5\uff1a"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js",metastring:'title="src/core/instance/lifecycle.js"',title:'"src/core/instance/lifecycle.js"'},"export function mountComponent(vm: Component, el: ?Element, hydrating?: boolean): Component {\n  vm.$el = el;\n  if (!vm.$options.render) {\n    vm.$options.render = createEmptyVNode;\n    // ...\n  }\n  callHook(vm, 'beforeMount');\n\n  // highlight-start\n  let updateComponent = () => {\n    vm._update(vm._render(), hydrating);\n  };\n  // highlight-end\n\n  // we set this to vm._watcher inside the watcher's constructor\n  // since the watcher's initial patch may call $forceUpdate (e.g. inside child\n  // component's mounted hook), which relies on vm._watcher being already defined\n  // highlight-start\n  new Watcher(\n    vm,\n    updateComponent,\n    noop,\n    {\n      before() {\n        if (vm._isMounted) {\n          callHook(vm, 'beforeUpdate');\n        }\n      },\n    },\n    true /* isRenderWatcher */\n  );\n  // highlight-end\n  hydrating = false;\n\n  // manually mounted instance, call mounted on self\n  // mounted is called for render-created child components in its inserted hook\n  if (vm.$vnode == null) {\n    vm._isMounted = true;\n    // highlight-next-line\n    callHook(vm, 'mounted');\n  }\n  return vm;\n}\n")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"mountComponent")," \u6838\u5fc3\u5c31\u662f\u5148\u5b9e\u4f8b\u5316\u4e00\u4e2a\u6e32\u67d3 ",Object(r.b)("inlineCode",{parentName:"p"},"Watcher"),"\uff0c\u5728\u5b83\u7684\u56de\u8c03\u51fd\u6570\u4e2d\u4f1a\u8c03\u7528 ",Object(r.b)("inlineCode",{parentName:"p"},"updateComponent")," \u65b9\u6cd5\uff0c\u5728\u6b64\u65b9\u6cd5\u4e2d\u8c03\u7528 ",Object(r.b)("inlineCode",{parentName:"p"},"vm._render")," \u65b9\u6cd5\u5148\u751f\u6210\u865a\u62df Node\uff0c\u6700\u7ec8\u8c03\u7528 ",Object(r.b)("inlineCode",{parentName:"p"},"vm._update")," \u66f4\u65b0 DOM\u3002"),Object(r.b)("div",{className:"admonition admonition-important alert alert--info"},Object(r.b)("div",{parentName:"div",className:"admonition-heading"},Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",{parentName:"h5",className:"admonition-icon"},Object(r.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"important")),Object(r.b)("div",{parentName:"div",className:"admonition-content"},Object(r.b)("p",{parentName:"div"},"vm.","_","render \u548c vm.","_","update \u5341\u5206\u91cd\u8981\u53c8\u96be\u4ee5\u7406\u89e3\uff0c\u5b83\u5305\u542b\u4e86\u8bb8\u591a Vue.js \u6846\u67b6\u7684\u7279\u6027\u3002"))),Object(r.b)("h2",{id:"render"},"render"),Object(r.b)("p",null,"Vue \u7684 ",Object(r.b)("inlineCode",{parentName:"p"},"_render")," \u65b9\u6cd5\u662f\u5b9e\u4f8b\u7684\u4e00\u4e2a\u79c1\u6709\u65b9\u6cd5\uff0c\u5b83\u7528\u6765",Object(r.b)("strong",{parentName:"p"},"\u628a\u5b9e\u4f8b\u6e32\u67d3\u6210\u4e00\u4e2a\u865a\u62df\u8282\u70b9"),"\u3002"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js",metastring:'title="src/core/instance/render.js"',title:'"src/core/instance/render.js"'},"Vue.prototype._render = function (): VNode {\n  const vm: Component = this;\n  const { render, _parentVnode } = vm.$options;\n\n  // reset _rendered flag on slots for duplicate slot check\n  if (process.env.NODE_ENV !== 'production') {\n    for (const key in vm.$slots) {\n      // $flow-disable-line\n      vm.$slots[key]._rendered = false;\n    }\n  }\n\n  if (_parentVnode) {\n    vm.$scopedSlots = _parentVnode.data.scopedSlots || emptyObject;\n  }\n\n  // set parent vnode. this allows render functions to have access\n  // to the data on the placeholder node.\n  vm.$vnode = _parentVnode;\n  // render self\n  let vnode;\n  try {\n    // highlight-next-line\n    vnode = render.call(vm._renderProxy, vm.$createElement);\n  } catch (e) {\n    // ...\n  }\n  // return empty vnode in case the render function errored out\n  if (!(vnode instanceof VNode)) {\n    if (process.env.NODE_ENV !== 'production' && Array.isArray(vnode)) {\n      warn(\n        'Multiple root nodes returned from render function. Render function ' +\n          'should return a single root node.',\n        vm\n      );\n    }\n    vnode = createEmptyVNode();\n  }\n  // set parent\n  vnode.parent = _parentVnode;\n  // highlight-next-line\n  return vnode;\n};\n")),Object(r.b)("p",null,"\u53ef\u4ee5\u770b\u5230\uff0c",Object(r.b)("inlineCode",{parentName:"p"},"render")," \u51fd\u6570\u4e2d\u7684 ",Object(r.b)("inlineCode",{parentName:"p"},"createElement")," \u65b9\u6cd5\u5c31\u662f ",Object(r.b)("inlineCode",{parentName:"p"},"vm.$createElement")," \u65b9\u6cd5\uff1a"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js"},"export function initRender(vm: Component) {\n  // ...\n  // bind the createElement fn to this instance\n  // so that we get proper render context inside it.\n  // args order: tag, data, children, normalizationType, alwaysNormalize\n  // internal version is used by render functions compiled from templates\n  vm._c = (a, b, c, d) => createElement(vm, a, b, c, d, false);\n  // normalization is always applied for the public version, used in\n  // user-written render functions.\n  vm.$createElement = (a, b, c, d) => createElement(vm, a, b, c, d, true);\n}\n")),Object(r.b)("h2",{id:"virtual-dom"},"Virtual DOM"),Object(r.b)("p",null,"\u771f\u6b63\u7684 DOM \u5143\u7d20\u662f\u975e\u5e38\u5e9e\u5927\u7684\uff0c\u56e0\u4e3a\u6d4f\u89c8\u5668\u7684\u6807\u51c6\u5c31\u628a DOM \u8bbe\u8ba1\u7684\u975e\u5e38\u590d\u6742\u3002\u5f53\u6211\u4eec\u9891\u7e41\u7684\u53bb\u505a DOM \u66f4\u65b0\uff0c\u4f1a\u4ea7\u751f\u4e00\u5b9a\u7684\u6027\u80fd\u95ee\u9898\u3002"),Object(r.b)("p",null,"\u800c Virtual DOM \u5c31\u662f\u7528\u4e00\u4e2a\u539f\u751f\u7684 JS \u5bf9\u8c61\u53bb\u63cf\u8ff0\u4e00\u4e2a DOM \u8282\u70b9\uff0c\u6240\u4ee5\u5b83\u6bd4\u521b\u5efa\u4e00\u4e2a DOM \u7684\u4ee3\u4ef7\u8981\u5c0f\u5f88\u591a\u3002\u5728 Vue.js \u4e2d\uff0cVirtual DOM \u662f\u7528 ",Object(r.b)("inlineCode",{parentName:"p"},"VNode")," \u8fd9\u4e48\u4e00\u4e2a Class \u53bb\u63cf\u8ff0\u3002"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js",metastring:'title="src/core/vdom/vnode.js"',title:'"src/core/vdom/vnode.js"'},"export default class VNode {\n  tag: string | void;\n  data: VNodeData | void;\n  children: ?Array<VNode>;\n  text: string | void;\n  elm: Node | void;\n  ns: string | void;\n  context: Component | void; // rendered in this component's scope\n  key: string | number | void;\n  componentOptions: VNodeComponentOptions | void;\n  componentInstance: Component | void; // component instance\n  parent: VNode | void; // component placeholder node\n\n  // strictly internal\n  raw: boolean; // contains raw HTML? (server only)\n  isStatic: boolean; // hoisted static node\n  isRootInsert: boolean; // necessary for enter transition check\n  isComment: boolean; // empty comment placeholder?\n  isCloned: boolean; // is a cloned node?\n  isOnce: boolean; // is a v-once node?\n  asyncFactory: Function | void; // async component factory function\n  asyncMeta: Object | void;\n  isAsyncPlaceholder: boolean;\n  ssrContext: Object | void;\n  fnContext: Component | void; // real context vm for functional nodes\n  fnOptions: ?ComponentOptions; // for SSR caching\n  fnScopeId: ?string; // functional scope id support\n\n  constructor(\n    tag?: string,\n    data?: VNodeData,\n    children?: ?Array<VNode>,\n    text?: string,\n    elm?: Node,\n    context?: Component,\n    componentOptions?: VNodeComponentOptions,\n    asyncFactory?: Function\n  ) {\n    this.tag = tag;\n    this.data = data;\n    this.children = children;\n    this.text = text;\n    this.elm = elm;\n    this.ns = undefined;\n    this.context = context;\n    this.fnContext = undefined;\n    this.fnOptions = undefined;\n    this.fnScopeId = undefined;\n    this.key = data && data.key;\n    this.componentOptions = componentOptions;\n    this.componentInstance = undefined;\n    this.parent = undefined;\n    this.raw = false;\n    this.isStatic = false;\n    this.isRootInsert = true;\n    this.isComment = false;\n    this.isCloned = false;\n    this.isOnce = false;\n    this.asyncFactory = asyncFactory;\n    this.asyncMeta = undefined;\n    this.isAsyncPlaceholder = false;\n  }\n\n  // DEPRECATED: alias for componentInstance for backwards compat.\n  /* istanbul ignore next */\n  get child(): Component | void {\n    return this.componentInstance;\n  }\n}\n")),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"Vue.js \u4e2d Virtual DOM \u662f\u501f\u9274\u4e86\u4e00\u4e2a\u5f00\u6e90\u5e93 ",Object(r.b)("a",{parentName:"p",href:"https://github.com/snabbdom/snabbdom"},"snabbdom")," \u7684\u5b9e\u73b0\uff0c\u7136\u540e\u52a0\u5165\u4e86\u4e00\u4e9b Vue.js \u7279\u8272\u7684\u4e1c\u897f\u3002")),Object(r.b)("p",null,"\u5176\u5b9e VNode \u662f\u5bf9\u771f\u5b9e DOM \u7684\u4e00\u79cd\u62bd\u8c61\u63cf\u8ff0\uff0c\u5b83\u7684\u6838\u5fc3\u5b9a\u4e49\u65e0\u975e\u5c31\u51e0\u4e2a\u5173\u952e\u5c5e\u6027\uff0c\u6807\u7b7e\u540d\u3001\u6570\u636e\u3001\u5b50\u8282\u70b9\u3001\u952e\u503c\u7b49\uff0c\u5176\u5b83\u5c5e\u6027\u90fd\u662f\u7528\u6765\u6269\u5c55 VNode \u7684\u7075\u6d3b\u6027\u4ee5\u53ca\u5b9e\u73b0\u4e00\u4e9b\u7279\u6b8a feature \u7684\u3002\u7531\u4e8e VNode \u53ea\u662f\u7528\u6765\u6620\u5c04\u5230\u771f\u5b9e DOM \u7684\u6e32\u67d3\uff0c\u4e0d\u9700\u8981\u5305\u542b\u64cd\u4f5c DOM \u7684\u65b9\u6cd5\uff0c\u56e0\u6b64\u5b83\u662f\u975e\u5e38\u8f7b\u91cf\u548c\u7b80\u5355\u7684\u3002"),Object(r.b)("p",null,"Virtual DOM \u9664\u4e86\u5b83\u7684\u6570\u636e\u7ed3\u6784\u7684\u5b9a\u4e49\uff0c\u6620\u5c04\u5230\u771f\u5b9e\u7684 DOM \u5b9e\u9645\u4e0a\u8981\u7ecf\u5386 VNode \u7684 create\u3001diff\u3001patch \u7b49\u8fc7\u7a0b\u3002\u90a3\u4e48\u5728 Vue.js \u4e2d\uff0cVNode \u7684 create \u662f\u901a\u8fc7 ",Object(r.b)("inlineCode",{parentName:"p"},"createElement")," \u65b9\u6cd5\u521b\u5efa\u7684\uff0c\u6211\u4eec\u63a5\u4e0b\u6765\u5206\u6790\u8fd9\u90e8\u5206\u7684\u5b9e\u73b0\u3002"),Object(r.b)("h2",{id:"createelement"},"createElement"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js",metastring:'title="src/core/vdom/create-element.js"',title:'"src/core/vdom/create-element.js"'},"// wrapper function for providing a more flexible interface\n// without getting yelled at by flow\nexport function createElement(\n  context: Component,\n  tag: any,\n  data: any,\n  children: any,\n  normalizationType: any,\n  alwaysNormalize: boolean\n): VNode | Array<VNode> {\n  if (Array.isArray(data) || isPrimitive(data)) {\n    normalizationType = children;\n    children = data;\n    data = undefined;\n  }\n  if (isTrue(alwaysNormalize)) {\n    normalizationType = ALWAYS_NORMALIZE;\n  }\n  // highlight-next-line\n  return _createElement(context, tag, data, children, normalizationType);\n}\n")),Object(r.b)("p",null,"\u5b9e\u9645\u4e0a\uff0c",Object(r.b)("inlineCode",{parentName:"p"},"_createElement")," \u624d\u662f\u771f\u6b63\u521b\u5efa VNode \u7684\u65b9\u6cd5\u3002"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js",metastring:'title=""',title:'""'},"export function _createElement(\n  context: Component,\n  tag?: string | Class<Component> | Function | Object,\n  data?: VNodeData,\n  children?: any,\n  normalizationType?: number\n): VNode | Array<VNode> {\n  if (isDef(data) && isDef((data: any).__ob__)) {\n    // ...\n    return createEmptyVNode();\n  }\n  // object syntax in v-bind\n  if (isDef(data) && isDef(data.is)) {\n    tag = data.is;\n  }\n  if (!tag) {\n    // in case of component :is set to falsy value\n    return createEmptyVNode();\n  }\n  // warn against non-primitive key\n  //...\n\n  // support single function children as default scoped slot\n  if (Array.isArray(children) && typeof children[0] === 'function') {\n    data = data || {};\n    data.scopedSlots = { default: children[0] };\n    children.length = 0;\n  }\n  // highlight-start\n  if (normalizationType === ALWAYS_NORMALIZE) {\n    children = normalizeChildren(children);\n  } else if (normalizationType === SIMPLE_NORMALIZE) {\n    children = simpleNormalizeChildren(children);\n  }\n  // highlight-end\n  let vnode, ns;\n  if (typeof tag === 'string') {\n    let Ctor;\n    ns = (context.$vnode && context.$vnode.ns) || config.getTagNamespace(tag);\n    if (config.isReservedTag(tag)) {\n      // platform built-in elements\n      // highlight-start\n      vnode = new VNode(\n        config.parsePlatformTagName(tag),\n        data,\n        children,\n        undefined,\n        undefined,\n        context\n      );\n      // highlight-end\n    } else if (isDef((Ctor = resolveAsset(context.$options, 'components', tag)))) {\n      // component\n      // highlight-next-line\n      vnode = createComponent(Ctor, data, context, children, tag);\n    } else {\n      // unknown or unlisted namespaced elements\n      // check at runtime because it may get assigned a namespace when its\n      // parent normalizes children\n      // highlight-next-line\n      vnode = new VNode(tag, data, children, undefined, undefined, context);\n    }\n  } else {\n    // direct component options / constructor\n    // highlight-next-line\n    vnode = createComponent(tag, data, context, children);\n  }\n  if (Array.isArray(vnode)) {\n    return vnode;\n  } else if (isDef(vnode)) {\n    if (isDef(ns)) applyNS(vnode, ns);\n    if (isDef(data)) registerDeepBindings(data);\n    return vnode;\n  } else {\n    return createEmptyVNode();\n  }\n}\n")),Object(r.b)("h3",{id:"children-\u7684\u89c4\u8303\u5316"},"children \u7684\u89c4\u8303\u5316"),Object(r.b)("p",null,"\u7531\u4e8e Virtual DOM \u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u6811\u72b6\u7ed3\u6784\uff0c\u6bcf\u4e00\u4e2a VNode \u53ef\u80fd\u4f1a\u6709\u82e5\u5e72\u4e2a\u5b50\u8282\u70b9\uff0c\u8fd9\u4e9b\u5b50\u8282\u70b9\u5e94\u8be5\u4e5f\u662f VNode \u7684\u7c7b\u578b\u3002",Object(r.b)("inlineCode",{parentName:"p"},"_createElement")," \u63a5\u6536\u7684\u7b2c 4 \u4e2a\u53c2\u6570 children \u662f\u4efb\u610f\u7c7b\u578b\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u628a\u5b83\u4eec\u89c4\u8303\u6210 VNode \u7c7b\u578b\u3002"),Object(r.b)("p",null,"\u8fd9\u91cc\u6839\u636e ",Object(r.b)("inlineCode",{parentName:"p"},"normalizationType")," \u7684\u4e0d\u540c\uff0c\u8c03\u7528\u4e86 ",Object(r.b)("inlineCode",{parentName:"p"},"normalizeChildren")," \u548c ",Object(r.b)("inlineCode",{parentName:"p"},"simpleNormalizeChildren")," \u65b9\u6cd5\u3002"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js",metastring:'title=""',title:'""'},"// The template compiler attempts to minimize the need for normalization by\n// statically analyzing the template at compile time.\n//\n// For plain HTML markup, normalization can be completely skipped because the\n// generated render function is guaranteed to return Array<VNode>. There are\n// two cases where extra normalization is needed:\n\n// 1. When the children contains components - because a functional component\n// may return an Array instead of a single root. In this case, just a simple\n// normalization is needed - if any child is an Array, we flatten the whole\n// thing with Array.prototype.concat. It is guaranteed to be only 1-level deep\n// because functional components already normalize their own children.\nexport function simpleNormalizeChildren(children: any) {\n  for (let i = 0; i < children.length; i++) {\n    if (Array.isArray(children[i])) {\n      return Array.prototype.concat.apply([], children);\n    }\n  }\n  return children;\n}\n\n// 2. When the children contains constructs that always generated nested Arrays,\n// e.g. <template>, <slot>, v-for, or when the children is provided by user\n// with hand-written render functions / JSX. In such cases a full normalization\n// is needed to cater to all possible types of children values.\nexport function normalizeChildren(children: any): ?Array<VNode> {\n  return isPrimitive(children)\n    ? [createTextVNode(children)]\n    : Array.isArray(children)\n    ? normalizeArrayChildren(children)\n    : undefined;\n}\n")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"simpleNormalizeChildren")," \u65b9\u6cd5\u8c03\u7528\u573a\u666f\u662f ",Object(r.b)("inlineCode",{parentName:"p"},"render")," \u51fd\u6570\u662f\u7f16\u8bd1\u751f\u6210\u7684\u3002\u7406\u8bba\u4e0a\u7f16\u8bd1\u751f\u6210\u7684 children \u90fd\u5df2\u7ecf\u662f VNode \u7c7b\u578b\u7684\uff0c\u4f46\u8fd9\u91cc\u6709\u4e00\u4e2a\u4f8b\u5916\uff0c\u5c31\u662f ",Object(r.b)("inlineCode",{parentName:"p"},"functional component")," \u51fd\u6570\u5f0f\u7ec4\u4ef6\u8fd4\u56de\u7684\u662f\u4e00\u4e2a\u6570\u7ec4\u800c\u4e0d\u662f\u4e00\u4e2a\u6839\u8282\u70b9\uff0c\u6240\u4ee5\u4f1a\u901a\u8fc7 ",Object(r.b)("inlineCode",{parentName:"p"},"Array.prototype.concat")," \u65b9\u6cd5\u628a\u6574\u4e2a children \u6570\u7ec4\u6253\u5e73\uff0c\u8ba9\u5b83\u7684\u6df1\u5ea6\u53ea\u6709\u4e00\u5c42\u3002"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"normalizeChildren")," \u65b9\u6cd5\u7684\u8c03\u7528\u573a\u666f\u6709 2 \u79cd\uff0c\u4e00\u4e2a\u573a\u666f\u662f render \u51fd\u6570\u662f\u7528\u6237\u624b\u5199\u7684\uff0c\u5f53 children \u53ea\u6709\u4e00\u4e2a\u8282\u70b9\u7684\u65f6\u5019\uff0cVue.js \u4ece\u63a5\u53e3\u5c42\u9762\u5141\u8bb8\u7528\u6237\u628a children \u5199\u6210\u57fa\u7840\u7c7b\u578b\u7528\u6765\u521b\u5efa\u5355\u4e2a\u7b80\u5355\u7684\u6587\u672c\u8282\u70b9\uff0c\u8fd9\u79cd\u60c5\u51b5\u4f1a\u8c03\u7528 ",Object(r.b)("inlineCode",{parentName:"p"},"createTextVNode")," \u521b\u5efa\u4e00\u4e2a\u6587\u672c\u8282\u70b9\u7684 VNode\uff1b\u53e6\u4e00\u4e2a\u573a\u666f\u662f\u5f53\u7f16\u8bd1 ",Object(r.b)("inlineCode",{parentName:"p"},"slot"),"\u3001",Object(r.b)("inlineCode",{parentName:"p"},"v-for")," \u7684\u65f6\u5019\u4f1a\u4ea7\u751f\u5d4c\u5957\u6570\u7ec4\u7684\u60c5\u51b5\uff0c\u4f1a\u8c03\u7528 ",Object(r.b)("inlineCode",{parentName:"p"},"normalizeArrayChildren")," \u65b9\u6cd5\u3002"),Object(r.b)("p",null,"\u7ecf\u8fc7\u5bf9 children \u7684\u89c4\u8303\u5316\uff0cchildren \u53d8\u6210\u4e86\u4e00\u4e2a\u7c7b\u578b\u4e3a VNode \u7684\u6570\u7ec4\u3002"),Object(r.b)("h3",{id:"vnode-\u7684\u521b\u5efa"},"VNode \u7684\u521b\u5efa"),Object(r.b)("p",null,"\u8fd9\u91cc\u5148\u5bf9 ",Object(r.b)("inlineCode",{parentName:"p"},"tag")," \u505a\u5224\u65ad\uff1a"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"\u5982\u679c\u662f string \u7c7b\u578b\uff0c\u5219\u63a5\u7740\u5224\u65ad\u5982\u679c\u662f\u5185\u7f6e\u7684\u4e00\u4e9b\u8282\u70b9\uff0c\u5219\u76f4\u63a5\u521b\u5efa\u4e00\u4e2a\u666e\u901a VNode\uff1b\u5982\u679c\u662f\u4e3a\u5df2\u6ce8\u518c\u7684\u7ec4\u4ef6\u540d\uff0c\u5219\u901a\u8fc7 ",Object(r.b)("inlineCode",{parentName:"li"},"createComponent")," \u521b\u5efa\u4e00\u4e2a\u7ec4\u4ef6\u7c7b\u578b\u7684 VNode\uff1b\u5426\u5219\u521b\u5efa\u4e00\u4e2a\u672a\u77e5\u7684\u6807\u7b7e\u7684 VNode\u3002"),Object(r.b)("li",{parentName:"ul"},"\u5982\u679c\u662f Component \u7c7b\u578b\uff0c\u5219\u76f4\u63a5\u8c03\u7528 ",Object(r.b)("inlineCode",{parentName:"li"},"createComponent")," \u521b\u5efa\u4e00\u4e2a\u7ec4\u4ef6\u7c7b\u578b\u7684 VNode \u8282\u70b9\u3002")),Object(r.b)("h2",{id:"update"},"update"),Object(r.b)("p",null,"Vue \u7684 ",Object(r.b)("inlineCode",{parentName:"p"},"_update")," \u662f\u5b9e\u4f8b\u7684\u4e00\u4e2a\u79c1\u6709\u65b9\u6cd5\uff0c\u5b83\u88ab\u8c03\u7528\u7684\u65f6\u673a\u6709 2 \u4e2a\uff0c\u4e00\u4e2a\u662f\u9996\u6b21\u6e32\u67d3\uff0c\u4e00\u4e2a\u662f\u6570\u636e\u66f4\u65b0\u7684\u65f6\u5019\u3002\u5b83\u7684\u4f5c\u7528\u662f\u5c06\u865a\u62df DOM \u6e32\u67d3\u6210\u771f\u5b9e DOM\u3002"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js",metastring:'title="src/core/instance/lifecycle.js"',title:'"src/core/instance/lifecycle.js"'},"Vue.prototype._update = function (vnode: VNode, hydrating?: boolean) {\n  const vm: Component = this;\n  const prevEl = vm.$el;\n  const prevVnode = vm._vnode;\n  const prevActiveInstance = activeInstance;\n  activeInstance = vm;\n  vm._vnode = vnode;\n  // Vue.prototype.__patch__ is injected in entry points\n  // based on the rendering backend used.\n  // highlight-start\n  if (!prevVnode) {\n    // initial render\n    vm.$el = vm.__patch__(vm.$el, vnode, hydrating, false /* removeOnly */);\n  } else {\n    // updates\n    vm.$el = vm.__patch__(prevVnode, vnode);\n  }\n  // highlight-end\n  activeInstance = prevActiveInstance;\n  // update __vue__ reference\n  if (prevEl) {\n    prevEl.__vue__ = null;\n  }\n  if (vm.$el) {\n    vm.$el.__vue__ = vm;\n  }\n  // if parent is an HOC, update its $el as well\n  if (vm.$vnode && vm.$parent && vm.$vnode === vm.$parent._vnode) {\n    vm.$parent.$el = vm.$el;\n  }\n  // updated hook is called by the scheduler to ensure that children are\n  // updated in a parent's updated hook.\n};\n")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"_update")," \u7684\u6838\u5fc3\u5c31\u662f\u8c03\u7528 ",Object(r.b)("inlineCode",{parentName:"p"},"vm.__patch__")," \u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u5728\u4e0d\u540c\u5e73\u53f0\u5b9a\u4e49\u4e5f\u4e0d\u540c\u3002\u5e38\u89c1\u7684 web \u5e73\u53f0\u5b9a\u4e49\uff1a"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js",metastring:'title="src/platforms/web/runtime/index.js"',title:'"src/platforms/web/runtime/index.js"'},"Vue.prototype.__patch__ = inBrowser ? patch : noop;\n")),Object(r.b)("p",null,"\u53ef\u4ee5\u770b\u5230\uff0c\u751a\u81f3\u5728 web \u5e73\u53f0\u4e0a\uff0c\u662f\u5426\u662f\u670d\u52a1\u7aef\u6e32\u67d3\u4e5f\u4f1a\u5bf9\u8fd9\u4e2a\u65b9\u6cd5\u4ea7\u751f\u5f71\u54cd\u3002\u56e0\u4e3a\u5728\u670d\u52a1\u7aef\u6e32\u67d3\u4e2d\uff0c\u6ca1\u6709\u771f\u5b9e\u7684\u6d4f\u89c8\u5668 DOM \u73af\u5883\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u628a VNode \u6700\u7ec8\u8f6c\u6362\u6210 DOM\uff0c\u56e0\u6b64\u662f\u4e00\u4e2a\u7a7a\u51fd\u6570\uff0c\u800c\u5728\u6d4f\u89c8\u5668\u7aef\u6e32\u67d3\u4e2d\uff0c\u5b83\u6307\u5411\u4e86 ",Object(r.b)("inlineCode",{parentName:"p"},"patch")," \u65b9\u6cd5\u3002"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js",metastring:'title="src/platforms/web/runtime/patch.js"',title:'"src/platforms/web/runtime/patch.js"'},"import * as nodeOps from 'web/runtime/node-ops';\nimport { createPatchFunction } from 'core/vdom/patch';\nimport baseModules from 'core/vdom/modules/index';\nimport platformModules from 'web/runtime/modules/index';\n\n// the directive module should be applied last, after all\n// built-in modules have been applied.\nconst modules = platformModules.concat(baseModules);\n// highlight-next-line\nexport const patch: Function = createPatchFunction({ nodeOps, modules });\n")),Object(r.b)("p",null,"\u8fd9\u91cc\u901a\u8fc7\u4f20\u5165 ",Object(r.b)("inlineCode",{parentName:"p"},"{nodeOps, modules}")," \u53c2\u6570\uff0c\u52a8\u6001\u521b\u5efa\u4e86\u4e00\u4e2a patch \u65b9\u6cd5\u3002\u5176\u4e2d\uff0c",Object(r.b)("inlineCode",{parentName:"p"},"nodeOps")," \u5c01\u88c5\u4e86\u4e00\u7cfb\u5217 DOM \u64cd\u4f5c\u7684\u65b9\u6cd5\uff0c",Object(r.b)("inlineCode",{parentName:"p"},"modules")," \u5b9a\u4e49\u4e86\u4e00\u4e9b\u6a21\u5757\u7684\u94a9\u5b50\u51fd\u6570\u7684\u5b9e\u73b0\u3002"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js",metastring:'title="src/core/vdom/patch.js"',title:'"src/core/vdom/patch.js"'},"const hooks = ['create', 'activate', 'update', 'remove', 'destroy'];\n\nexport function createPatchFunction(backend) {\n  let i, j;\n  const cbs = {};\n\n  const { modules, nodeOps } = backend;\n\n  for (i = 0; i < hooks.length; ++i) {\n    cbs[hooks[i]] = [];\n    for (j = 0; j < modules.length; ++j) {\n      if (isDef(modules[j][hooks[i]])) {\n        cbs[hooks[i]].push(modules[j][hooks[i]]);\n      }\n    }\n  }\n\n  // ...\n\n  return function patch(oldVnode, vnode, hydrating, removeOnly) {\n    if (isUndef(vnode)) {\n      if (isDef(oldVnode)) invokeDestroyHook(oldVnode);\n      return;\n    }\n\n    let isInitialPatch = false;\n    const insertedVnodeQueue = [];\n\n    if (isUndef(oldVnode)) {\n      // empty mount (likely as component), create new root element\n      isInitialPatch = true;\n      createElm(vnode, insertedVnodeQueue);\n    } else {\n      const isRealElement = isDef(oldVnode.nodeType);\n      if (!isRealElement && sameVnode(oldVnode, vnode)) {\n        // patch existing root node\n        patchVnode(oldVnode, vnode, insertedVnodeQueue, removeOnly);\n      } else {\n        if (isRealElement) {\n          // mounting to a real element\n          // check if this is server-rendered content and if we can perform\n          // a successful hydration.\n          // ...\n          // either not server-rendered, or hydration failed.\n          // create an empty node and replace it\n          oldVnode = emptyNodeAt(oldVnode);\n        }\n\n        // replacing existing element\n        const oldElm = oldVnode.elm;\n        const parentElm = nodeOps.parentNode(oldElm);\n\n        // create new node\n        // highlight-start\n        createElm(\n          vnode,\n          insertedVnodeQueue,\n          // extremely rare edge case: do not insert if old element is in a\n          // leaving transition. Only happens when combining transition +\n          // keep-alive + HOCs. (#4590)\n          oldElm._leaveCb ? null : parentElm,\n          nodeOps.nextSibling(oldElm)\n        );\n        // highlight-end\n\n        // update parent placeholder node element, recursively\n        if (isDef(vnode.parent)) {\n          let ancestor = vnode.parent;\n          const patchable = isPatchable(vnode);\n          while (ancestor) {\n            for (let i = 0; i < cbs.destroy.length; ++i) {\n              cbs.destroy[i](ancestor);\n            }\n            ancestor.elm = vnode.elm;\n            if (patchable) {\n              for (let i = 0; i < cbs.create.length; ++i) {\n                cbs.create[i](emptyNode, ancestor);\n              }\n              // #6513\n              // invoke insert hooks that may have been merged by create hooks.\n              // e.g. for directives that uses the \"inserted\" hook.\n              const insert = ancestor.data.hook.insert;\n              if (insert.merged) {\n                // start at index 1 to avoid re-invoking component mounted hook\n                for (let i = 1; i < insert.fns.length; i++) {\n                  insert.fns[i]();\n                }\n              }\n            } else {\n              registerRef(ancestor);\n            }\n            ancestor = ancestor.parent;\n          }\n        }\n\n        // destroy old node\n        if (isDef(parentElm)) {\n          removeVnodes(parentElm, [oldVnode], 0, 0);\n        } else if (isDef(oldVnode.tag)) {\n          invokeDestroyHook(oldVnode);\n        }\n      }\n    }\n\n    invokeInsertHook(vnode, insertedVnodeQueue, isInitialPatch);\n    return vnode.elm;\n  };\n}\n")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"patch")," \u7684\u903b\u8f91\u770b\u4e0a\u53bb\u5341\u5206\u590d\u6742\uff0c\u5373\u4f7f\u79fb\u9664\u4e86\u670d\u52a1\u7aef\u6e32\u67d3\u76f8\u5173\u7684\u903b\u8f91\u4ecd\u7136\u96be\u4ee5\u7406\u89e3\uff0c\u56e0\u4e3a\u5b83\u6709\u4f17\u591a\u7684\u5206\u652f\u903b\u8f91\u3002\u4f46\u6211\u4eec\u90fd\u77e5\u9053\uff0c\u8fd9\u91cc\u540e\u7eed\u7684\u903b\u8f91\u5c31\u662f\u4e3a\u4e86\u521b\u5efa\u771f\u5b9e Node\uff0c\u56e0\u6b64 ",Object(r.b)("inlineCode",{parentName:"p"},"createElm")," \u5728\u8fd9\u91cc\u975e\u5e38\u91cd\u8981\u3002"),Object(r.b)("h3",{id:"createelm"},"createElm"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"createElm")," \u7684\u4f5c\u7528\u662f\u901a\u8fc7\u865a\u62df\u8282\u70b9\u521b\u5efa\u771f\u5b9e\u7684 DOM \u5e76\u63d2\u5165\u5230\u5b83\u7684\u7236\u8282\u70b9\u4e2d\u3002"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js",metastring:'title="src/core/vdom/patch.js"',title:'"src/core/vdom/patch.js"'},"function createElm(vnode, insertedVnodeQueue, parentElm, refElm, nested, ownerArray, index) {\n  if (isDef(vnode.elm) && isDef(ownerArray)) {\n    // This vnode was used in a previous render!\n    // now it's used as a new node, overwriting its elm would cause\n    // potential patch errors down the road when it's used as an insertion\n    // reference node. Instead, we clone the node on-demand before creating\n    // associated DOM element for it.\n    vnode = ownerArray[index] = cloneVNode(vnode);\n  }\n\n  vnode.isRootInsert = !nested; // for transition enter check\n  // highlight-start\n  if (createComponent(vnode, insertedVnodeQueue, parentElm, refElm)) {\n    return;\n  }\n  // highlight-end\n\n  const data = vnode.data;\n  const children = vnode.children;\n  const tag = vnode.tag;\n  if (isDef(tag)) {\n    // ...\n    // highlight-start\n    vnode.elm = vnode.ns\n      ? nodeOps.createElementNS(vnode.ns, tag)\n      : nodeOps.createElement(tag, vnode);\n    // highlight-end\n    setScope(vnode);\n\n    /* istanbul ignore if */\n    if (__WEEX__) {\n      // ...\n    } else {\n      // highlight-next-line\n      createChildren(vnode, children, insertedVnodeQueue);\n      if (isDef(data)) {\n        invokeCreateHooks(vnode, insertedVnodeQueue);\n      }\n      insert(parentElm, vnode.elm, refElm);\n    }\n\n    if (process.env.NODE_ENV !== 'production' && data && data.pre) {\n      creatingElmInVPre--;\n    }\n  } else if (isTrue(vnode.isComment)) {\n    vnode.elm = nodeOps.createComment(vnode.text);\n    insert(parentElm, vnode.elm, refElm);\n  } else {\n    vnode.elm = nodeOps.createTextNode(vnode.text);\n    insert(parentElm, vnode.elm, refElm);\n  }\n}\n")),Object(r.b)("p",null,"\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u5b83\u7684\u4e00\u4e9b\u5173\u952e\u903b\u8f91\uff0ccreateComponent \u65b9\u6cd5\u76ee\u7684\u662f\u5c1d\u8bd5\u521b\u5efa\u5b50\u7ec4\u4ef6\uff1b\u63a5\u4e0b\u6765\u5224\u65ad ",Object(r.b)("inlineCode",{parentName:"p"},"vnode")," \u662f\u5426\u5305\u542b tag\uff0c\u5982\u679c\u5305\u542b\uff0c\u5148\u7b80\u5355\u5bf9 tag \u7684\u5408\u6cd5\u6027\u5728\u975e\u751f\u4ea7\u73af\u5883\u4e0b\u505a\u6821\u9a8c\uff0c\u770b\u662f\u5426\u662f\u4e00\u4e2a\u5408\u6cd5\u6807\u7b7e\uff1b\u7136\u540e\u518d\u53bb\u8c03\u7528\u5e73\u53f0 DOM \u7684\u64cd\u4f5c\u53bb\u521b\u5efa\u4e00\u4e2a\u5360\u4f4d\u7b26\u5143\u7d20\u3002\u63a5\u4e0b\u6765\u8c03\u7528 ",Object(r.b)("inlineCode",{parentName:"p"},"createChildren")," \u65b9\u6cd5\u53bb\u521b\u5efa\u5b50\u5143\u7d20\u3002"),Object(r.b)("h3",{id:"createchildren"},"createChildren"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js",metastring:'title="src/core/vdom/patch.js"',title:'"src/core/vdom/patch.js"'},"function createChildren(vnode, children, insertedVnodeQueue) {\n  if (Array.isArray(children)) {\n    if (process.env.NODE_ENV !== 'production') {\n      checkDuplicateKeys(children);\n    }\n    // highlight-start\n    for (let i = 0; i < children.length; ++i) {\n      createElm(children[i], insertedVnodeQueue, vnode.elm, null, true, children, i);\n    }\n    // highlight-end\n  } else if (isPrimitive(vnode.text)) {\n    nodeOps.appendChild(vnode.elm, nodeOps.createTextNode(String(vnode.text)));\n  }\n}\n")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"createChildren")," \u7684\u903b\u8f91\u5f88\u7b80\u5355\uff0c\u5b9e\u9645\u4e0a\u662f\u904d\u5386\u5b50\u865a\u62df\u8282\u70b9\uff0c\u9012\u5f52\u8c03\u7528 ",Object(r.b)("inlineCode",{parentName:"p"},"createElm"),"\uff0c\u8fd9\u662f\u4e00\u79cd\u5e38\u7528\u7684\u6df1\u5ea6\u4f18\u5148\u7684\u904d\u5386\u7b97\u6cd5\uff0c\u8fd9\u91cc\u8981\u6ce8\u610f\u7684\u4e00\u70b9\u662f\u5728\u904d\u5386\u8fc7\u7a0b\u4e2d\u4f1a\u628a ",Object(r.b)("inlineCode",{parentName:"p"},"vnode.elm")," \u4f5c\u4e3a\u7236\u5bb9\u5668\u7684 DOM \u8282\u70b9\u5360\u4f4d\u7b26\u4f20\u5165\u3002"),Object(r.b)("p",null,"\u63a5\u7740\u518d\u8c03\u7528 ",Object(r.b)("inlineCode",{parentName:"p"},"invokeCreateHooks")," \u65b9\u6cd5\u6267\u884c\u6240\u6709\u7684 create \u7684\u94a9\u5b50\u5e76\u628a ",Object(r.b)("inlineCode",{parentName:"p"},"vnode")," push \u5230 ",Object(r.b)("inlineCode",{parentName:"p"},"insertedVnodeQueue")," \u4e2d\u3002\u6700\u540e\u8c03\u7528 ",Object(r.b)("inlineCode",{parentName:"p"},"insert")," \u65b9\u6cd5\u628a DOM \u63d2\u5165\u5230\u7236\u8282\u70b9\u4e2d\uff0c\u56e0\u4e3a\u662f\u9012\u5f52\u8c03\u7528\uff0c\u5b50\u5143\u7d20\u4f1a\u4f18\u5148\u8c03\u7528 ",Object(r.b)("inlineCode",{parentName:"p"},"insert"),"\uff0c\u6240\u4ee5\u6574\u4e2a ",Object(r.b)("inlineCode",{parentName:"p"},"vnode")," \u6811\u8282\u70b9\u7684\u63d2\u5165\u987a\u5e8f\u662f\u5148\u5b50\u540e\u7236\u3002"),Object(r.b)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),Object(r.b)("p",null,"\u4e0a\u9762\u6211\u4eec\u68b3\u7406\u4e86\u628a\u6a21\u677f\u548c\u6570\u636e\u6e32\u67d3\u6210\u6700\u7ec8\u7684 DOM \u7684\u8fc7\u7a0b\u3002\u5176\u5b9e\u7406\u89e3\u5230 ",Object(r.b)("inlineCode",{parentName:"p"},"mountComponent")," \u65b9\u6cd5\u5b9e\u4f8b\u4e86\u4e00\u4e2a\u6e32\u67d3 Watcher\uff0c\u628a\u66f4\u65b0\u89c6\u56fe\u7684\u903b\u8f91\u6ce8\u518c\u5230\u56de\u8c03\u91cc\u5373\u53ef\uff0c\u5176\u4ed6\u7684\u5185\u5bb9\u518d\u6df1\u5165\u5c31\u8bbe\u8ba1\u5230\u7f16\u8bd1\u8fc7\u7a0b\u4e86\u3002"),Object(r.b)("p",null,Object(r.b)("img",{alt:"new vue",src:t(158).default})),Object(r.b)("p",null,"\u6574\u4e2a\u8fc7\u7a0b\u770b\u8d77\u6765\u5341\u5206\u590d\u6742\uff0c\u56e0\u4e3a\u5206\u652f\u903b\u8f91\u592a\u591a\uff0c\u4e14\u5f88\u96be\u7406\u6e05\u3002\u5b9e\u9645\u4e0a\uff0c\u8fd9\u662f\u52a8\u6001\u7ed9\u6784\u9020\u51fd\u6570\u88c5\u914d\u5c5e\u6027\u65b9\u6cd5\uff0c\u7136\u540e\u6267\u884c\u65b9\u6cd5\u7684\u8fc7\u7a0b\u3002\u4ece\u4e3b\u7ebf\u4e0a\u6765\u770b\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5b8c\u6210\u4e86\u4ee5\u4e0b\u51e0\u4ef6\u4e8b\uff1a"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("strong",{parentName:"li"},"\u521d\u59cb\u5316\u9636\u6bb5"),"\uff1a\u5408\u5e76\u914d\u7f6e\uff0c\u521d\u59cb\u5316\u751f\u547d\u5468\u671f\uff0c\u521d\u59cb\u5316\u4e8b\u4ef6\u4e2d\u5fc3\uff0c\u521d\u59cb\u5316\u6e32\u67d3\uff0c\u521d\u59cb\u5316 data\u3001props\u3001computed\u3001watcher \u7b49\uff0c\u7136\u540e\u6267\u884c ",Object(r.b)("inlineCode",{parentName:"li"},"$mount")," \u65b9\u6cd5\u5c06\u751f\u547d\u5468\u671f\u63a8\u5165 Mount \u9636\u6bb5\u3002"),Object(r.b)("li",{parentName:"ol"},Object(r.b)("strong",{parentName:"li"},"\u6302\u8f7d\u9636\u6bb5"),"\uff1a\u9996\u5148\uff0c\u6821\u9a8c\u5b9e\u4f8b\u662f\u5426\u5b58\u5728 render \u51fd\u6570\uff0c\u5982\u679c\u6ca1\u6709\u5219\u5c06 template/el \u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a render \u51fd\u6570\uff0c\u4e5f\u5c31\u662f\u8bf4 render \u51fd\u6570\u624d\u662f\u751f\u6210 VNode \u7684\u5173\u952e\uff1b\u7136\u540e\uff0c\u6267\u884c ",Object(r.b)("inlineCode",{parentName:"li"},"mountComponent")," \u65b9\u6cd5\u5b9e\u4f8b\u5316\u4e00\u4e2a\u6e32\u67d3 Watcher\uff0c\u628a\u521b\u5efa VNode\u3001\u8f6c\u6362\u4e3a\u771f\u5b9e\u8282\u70b9\u3001\u6267\u884c patch \u65b9\u6cd5\u66f4\u65b0 DOM \u7b49\u903b\u8f91\u6ce8\u518c\u5230\u56de\u8c03\u51fd\u6570\u4e2d\uff1b\u6700\u540e\uff0c\u6570\u636e\u53d8\u5316\u89e6\u53d1\u89c6\u56fe\u66f4\u65b0\u3002")),Object(r.b)("p",null,"\u53ef\u4ee5\u770b\u5230\uff0c\u6574\u4e2a\u8fc7\u7a0b\u7406\u6e05\u540e\u5e76\u4e0d\u590d\u6742\uff0c\u96be\u70b9\u5728\u4e8e\u751f\u6210 render \u51fd\u6570\u3001\u6267\u884c render \u51fd\u6570\u751f\u6210 VNode\u3001\u5c06 VNode \u8f6c\u6362\u4e3a\u771f\u5b9e\u8282\u70b9\u3001\u6267\u884c patch \u65b9\u6cd5\u66f4\u65b0 DOM \u7b49\uff0c\u8fd9\u4e9b\u6d89\u53ca\u7684\u70b9\u5927\u591a\u6570\u90fd\u8ddf\u6846\u67b6\u672c\u8eab\u7684\u7279\u6027\u6709\u5173\u8054\uff0c\u7406\u6e05\u695a\u57fa\u672c\u5c31\u662f\u5bf9 Vue.js \u65e0\u6240\u4e0d\u77e5\u4e86\u3002"))}s.isMDXComponent=!0}}]);