<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/fex/blog/rss.xml" title="FEX Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/fex/blog/atom.xml" title="FEX Blog Atom Feed"><title data-react-helmet="true">跨域 | FEX</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="跨域 | FEX"><meta data-react-helmet="true" name="description" content="什么是跨域"><meta data-react-helmet="true" property="og:description" content="什么是跨域"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/fex/docs/advanced/browser/cross-origin"><link data-react-helmet="true" rel="shortcut icon" href="/fex/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/fex/docs/advanced/browser/cross-origin"><link rel="stylesheet" href="/fex/styles.1cdc928b.css">
<link rel="preload" href="/fex/styles.ffb24f24.js" as="script">
<link rel="preload" href="/fex/runtime~main.8eec90ca.js" as="script">
<link rel="preload" href="/fex/main.d2410b1b.js" as="script">
<link rel="preload" href="/fex/1.59af2fa2.js" as="script">
<link rel="preload" href="/fex/2.8c48b619.js" as="script">
<link rel="preload" href="/fex/85.dafc7ca9.js" as="script">
<link rel="preload" href="/fex/86.4d0dbeda.js" as="script">
<link rel="preload" href="/fex/935f2afb.65d2679f.js" as="script">
<link rel="preload" href="/fex/17896441.f11c0cb6.js" as="script">
<link rel="preload" href="/fex/b2b771a7.03f54ade.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/fex/"><img src="/fex/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/fex/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">FEX</strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/fex/docs/advanced">前端进阶</a><a class="navbar__item navbar__link" href="/fex/docs/engineering">工程化</a><a class="navbar__item navbar__link" href="/fex/docs/performance">性能优化</a><a href="https://github.com/oxyzhg/fex" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/fex/"><img src="/fex/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/fex/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">FEX</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/fex/docs/advanced">前端进阶</a></li><li class="menu__list-item"><a class="menu__link" href="/fex/docs/engineering">工程化</a></li><li class="menu__list-item"><a class="menu__link" href="/fex/docs/performance">性能优化</a></li><li class="menu__list-item"><a href="https://github.com/oxyzhg/fex" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/fex/docs/advanced">概览</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">JavaScript</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/javascript/inheritance">继承</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/javascript/eventloop">事件循环</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Vue.js</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/vue">概览</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/vue/data-driven">数据驱动</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/vue/componentization">组件化</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/vue/reactive">响应式原理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/vue/compile">编译</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/vue/lifecycle">生命周期</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/vue/next-tick">nextTick</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/vue/computed-vs-watch">计算属性 vs 侦听属性</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/vue/component-update">组件更新</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/vue/v-model">v-model</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/vue/mvvm">MVVM</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">React.js</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/react/lifecycle">生命周期</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">浏览器</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/fex/docs/advanced/browser/from-url-to-page-load">从输入URL到页面加载过程</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/fex/docs/advanced/browser/browser-storage">浏览器存储</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/fex/docs/advanced/browser/browser-cache">浏览器缓存</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/fex/docs/advanced/browser/browser-gc">垃圾回收</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/fex/docs/advanced/browser/cross-origin">跨域</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">安全</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/security">概览</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/security/xss">XSS 攻击</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/security/csrf">CSRF 攻击</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">网络</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/network/http">HTTP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/network/websocket">WebSocket</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">跨域</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="什么是跨域"></a>什么是跨域<a class="hash-link" href="#什么是跨域" title="Direct link to heading">#</a></h2><p>跨域是指一个域下的文档或脚本试图去请求另一个域下的资源，这里跨域是广义的。</p><p>广义的跨域有：</p><ul><li>资源跳转：外链、重定向、表单提交</li><li>资源嵌入：<code>&lt;link&gt;</code>, <code>&lt;script&gt;</code>, <code>&lt;img&gt;</code>, <code>&lt;frame&gt;</code> 等 DOM 标签，还有样式中 <code>background:url()</code>, <code>@font-face()</code> 等文件外链</li><li>脚本请求：JavaScript 发起的 Ajax 请求、DOM 和 JavaScript 对象的跨域操作等</li></ul><p>实际上，我们通常所说的跨域，是由浏览器<strong>同源策略</strong>限制的一类请求场景。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="同源策略"></a>同源策略<a class="hash-link" href="#同源策略" title="Direct link to heading">#</a></h2><p>同源策略（SOP, Same origin policy）是一种约定，它是浏览器最核心也最基本的安全功能，如果缺少了同源策略，浏览器很容易受到 XSS、CSFR 等攻击。所谓同源是指<strong>协议+域名+端口</strong>三者相同，即便两个不同的域名指向同一个 IP 地址，也非同源。</p><p>同源策略限制的内容有以下几种：</p><ul><li>Cookie、localStorage 和 IndexDB 等存储性内容</li><li>DOM 节点</li><li>AJAX 请求发送后，被浏览器拦截</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="跨域解决方案"></a>跨域解决方案<a class="hash-link" href="#跨域解决方案" title="Direct link to heading">#</a></h2><ol><li>JSONP</li><li>CORS</li><li>postMessage</li><li>WebSocket</li><li>Node 中间件代理</li><li>Nginx 反向代理</li><li>window.name+iframe</li><li>location.hash+iframe</li><li>document.domain+iframe</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="jsonp"></a>JSONP<a class="hash-link" href="#jsonp" title="Direct link to heading">#</a></h3><p>原理：利用 <code>&lt;script&gt;</code> 标签没有跨域限制的漏洞，网页可以得到从其他来源动态产生的 JSON 数据。JSONP 请求一定需要对方的服务器做支持才可以。</p><p>虽然 JSONP 和 AJAX 一样，都是客户端向服务器端发送请求，从服务器端获取数据的方式。但 AJAX 属于同源策略，JSONP 属于非同源策略。</p><p>JSONP 优点是简单兼容性好，可用于解决主流浏览器的跨域数据访问的问题。缺点是仅支持 GET 方法具有局限性，不安全可能会遭受 XSS 攻击。</p><p>实现流程：</p><ol><li>声明一个回调函数，其函数名作参数值传递给跨域请求数据的服务器，函数形参为要获取目标数据。</li><li>创建一个 <code>&lt;script&gt;</code> 标签，把跨域的 API 接口地址赋值给 src 属性，并向服务器传递该函数名。</li><li>服务器接收到请求后，需要进行特殊的处理：把传递进来的函数名和它需要给你的数据拼接成一个字符串返回。如：传递 <code>?callback=show</code>，返回 <code>show(data)</code></li><li>最后服务器响应的内容，在浏览器得到执行，即执行了请求参数中的回调函数，并传入返回数据。</li></ol><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-js codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">jsonp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token parameter"> url</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"> params</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"> callback </span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#e3116c">return</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">Promise</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> script </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(156, 220, 254)">document</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">createElement</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&#x27;script&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token dom variable" style="color:rgb(156, 220, 254)">window</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">callback</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token function" style="color:rgb(111, 66, 193)">resolve</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token dom variable" style="color:rgb(156, 220, 254)">document</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">body</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">removeChild</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">script</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    params </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token spread operator" style="color:rgb(0, 92, 197)">...</span><span class="token plain">params</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> callback </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// wd=b&amp;callback=show</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> arrs </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#e3116c">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> key </span><span class="token keyword" style="color:#e3116c">in</span><span class="token plain"> params</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      arrs</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">push</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(36, 41, 46)">${</span><span class="token template-string interpolation">key</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token template-string string">=</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(36, 41, 46)">${</span><span class="token template-string interpolation">params</span><span class="token template-string interpolation punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token template-string interpolation">key</span><span class="token template-string interpolation punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    script</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">src</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(36, 41, 46)">${</span><span class="token template-string interpolation">url</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token template-string string">?</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(36, 41, 46)">${</span><span class="token template-string interpolation">arrs</span><span class="token template-string interpolation punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token template-string interpolation function" style="color:rgb(111, 66, 193)">join</span><span class="token template-string interpolation punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token template-string interpolation string">&#x27;&amp;&#x27;</span><span class="token template-string interpolation punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token dom variable" style="color:rgb(156, 220, 254)">document</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">body</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">appendChild</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">script</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="cors"></a>CORS<a class="hash-link" href="#cors" title="Direct link to heading">#</a></h3><p>CORS（Cross-origin resource sharing）跨域资源共享，它允许浏览器向跨源服务器发出 XMLHttpRequest 请求。</p><p>CORS 需要浏览器和服务器同时支持。浏览器会自动进行 CORS 通信，实现 CORS 通信的关键是后端服务。只要服务器实现了 CORS 接口，就可以跨源通信。</p><p>浏览器将 CORS 请求分成两类：</p><ul><li>简单请求（simple request）</li><li>非简单请求（not-so-simple request）</li></ul><p>只要同时满足以下两大条件，就属于简单请求。</p><ol><li>请求方法是以下三种方法之一：<code>HEAD</code>、<code>GET</code>、<code>POST</code></li><li>HTTP 的头信息不超出以下几种字段：<code>Accept</code>、<code>Accept-Language</code>、<code>Content-Language</code>、<code>Last-Event-ID</code>、<code>Content-Type</code>（只限于三个值 <code>application/x-www-form-urlencoded</code>、<code>multipart/form-data</code>、<code>text/plain</code>）</li></ol><p>浏览器对这两种请求的处理，是不一样的。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="简单请求"></a>简单请求<a class="hash-link" href="#简单请求" title="Direct link to heading">#</a></h4><p>对于简单请求，浏览器直接发出 CORS 请求。具体来说，就是在头信息之中，增加一个 <code>Origin</code> 字段。服务器根据这个值，决定是否同意这次请求。</p><p>如果 Origin 指定的源，不在许可范围内，服务器会返回一个正常的 HTTP 回应。浏览器发现，这个回应的头信息没有包含 <code>Access-Control-Allow-Origin</code> 字段，会抛出一个错误，被 XMLHttpRequest 的 <code>onerror</code> 回调函数捕获。注意，这种错误无法通过状态码识别，因为 HTTP 回应的状态码有可能是 200。</p><p>如果 Origin 指定的域名在许可范围内，服务器返回的响应，会多出几个头信息字段。</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-plain codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">Access-Control-Allow-Origin: http://api.domain.com</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">Access-Control-Allow-Credentials: true</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">Access-Control-Expose-Headers: foobar</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">Content-Type: text/html;charset=utf-8</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="非简单请求"></a>非简单请求<a class="hash-link" href="#非简单请求" title="Direct link to heading">#</a></h4><p>非简单请求是对服务器有特殊要求的请求，比如请求方法是 PUT 或 DELETE，或者 Content-Type 字段的类型是 application/json。</p><p>非简单请求的 CORS 请求，会在正式通信之前，增加一次 HTTP 查询请求，称为<strong>预检请求</strong>（preflight）。</p><p>服务器收到预检请求以后，检查了 <code>Origin</code>、<code>Access-Control-Request-Method</code> 和 <code>Access-Control-Request-Headers</code> 字段以后，确认允许跨源请求，就可以做出回应。</p><p>如果服务器否定了预检请求，会返回一个正常的 HTTP 回应。浏览器发现没有任何 CORS 相关的头信息字段会抛出一个错误，被 XMLHttpRequest 的 <code>onerror</code> 回调函数捕获。</p><p>服务器回应的 CORS 相关字段如下：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-plain codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">Access-Control-Allow-Methods: GET, POST, PUT</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">Access-Control-Allow-Headers: X-Custom-Header</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">Access-Control-Allow-Credentials: true</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">Access-Control-Max-Age: 1728000</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>一旦服务器通过了预检请求，以后每次浏览器正常的 CORS 请求，就都跟简单请求一样，会有一个 <code>Origin</code> 头信息字段。服务器的回应，也都会有一个 <code>Access-Control-Allow-Origin</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="websocket"></a>WebSocket<a class="hash-link" href="#websocket" title="Direct link to heading">#</a></h3><p>WebSocket 是 HTML5 的一个持久化的协议，它实现了浏览器与服务器的全双工通信，同时也是跨域的一种解决方案。WebSocket 和 HTTP 都是应用层协议，都基于 TCP 协议。但是 WebSocket 是一种双向通信协议，在建立连接之后，WebSocket 的 server 与 client 都能主动向对方发送或接收数据。同时，WebSocket 在建立连接时需要借助 HTTP 协议，连接建立好了之后 client 与 server 之间的双向通信就与 HTTP 无关了。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="postmessage"></a>postMessage<a class="hash-link" href="#postmessage" title="Direct link to heading">#</a></h3><p>postMessage 是 HTML5 XMLHttpRequest API，且是为数不多可以跨域操作的 window 属性之一，它可用于解决以下方面的问题：</p><ul><li>页面和其打开的新窗口的数据传递</li><li>多窗口之间消息传递</li><li>页面与嵌套的 iframe 消息传递</li><li>上面三个场景的跨域数据传递</li></ul><p>postMessage 方法允许来自不同源的脚本采用异步方式进行有限的通信，可以实现跨文本档、多窗口、跨域消息传递。</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-js codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">otherWindow</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">postMessage</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> targetOrigin</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">transfer</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="node-中间件代理"></a>Node 中间件代理<a class="hash-link" href="#node-中间件代理" title="Direct link to heading">#</a></h3><p>实现原理：同源策略是浏览器需要遵循的标准，而如果是服务器向服务器请求就无需遵循同源策略。代理服务器，需要做以下几个步骤：</p><ul><li>接受客户端请求</li><li>将请求转发给服务器</li><li>拿到服务器响应数据</li><li>将响应转发给客户端</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="nginx-反向代理"></a>Nginx 反向代理<a class="hash-link" href="#nginx-反向代理" title="Direct link to heading">#</a></h3><p>实现原理类似于 Node 中间件代理，需要搭建一个中转 Nginx 服务器，用于转发请求。不同的是，Node 是正向代理，而 Ngixn 是反向代理。</p><p>使用 Nginx 反向代理实现跨域，是最简单的跨域方式。只需要修改 Nginx 的配置即可解决跨域问题，支持所有浏览器，支持 session，不需要修改任何代码，并且不会影响服务器性能。</p><p>实现思路：通过 Nginx 配置一个代理服务器（域名与 domain1 相同，端口不同）做跳板机，反向代理访问 domain2 接口，并且可以顺便修改 cookie 中 domain 信息，方便当前域 cookie 写入，实现跨域登录。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="总结"></a>总结<a class="hash-link" href="#总结" title="Direct link to heading">#</a></h2><ul><li>CORS 支持所有类型的 HTTP 请求，是跨域 HTTP 请求的根本解决方案</li><li>JSONP 只支持 GET 请求，JSONP 的优势在于支持老式浏览器，以及可以向不支持 CORS 的网站请求数据。</li><li>不管是 Node 中间件代理还是 nginx 反向代理，主要是通过同源策略对服务器不加限制。</li><li>日常工作中，用得比较多的跨域方案是 cors 和 nginx 反向代理</li></ul><hr><p>参考资料：</p><ul><li><a href="http://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="noopener noreferrer">跨域资源共享 CORS 详解</a></li><li><a href="https://juejin.cn/post/6844903767226351623" target="_blank" rel="noopener noreferrer">九种跨域方式实现原理（完整版）</a></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/oxyzhg/fex/edit/main/docs/advanced/browser/cross-origin.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/fex/docs/advanced/browser/browser-gc"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 垃圾回收</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/fex/docs/advanced/security"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">概览 »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#什么是跨域" class="table-of-contents__link">什么是跨域</a></li><li><a href="#同源策略" class="table-of-contents__link">同源策略</a></li><li><a href="#跨域解决方案" class="table-of-contents__link">跨域解决方案</a><ul><li><a href="#jsonp" class="table-of-contents__link">JSONP</a></li><li><a href="#cors" class="table-of-contents__link">CORS</a></li><li><a href="#websocket" class="table-of-contents__link">WebSocket</a></li><li><a href="#postmessage" class="table-of-contents__link">postMessage</a></li><li><a href="#node-中间件代理" class="table-of-contents__link">Node 中间件代理</a></li><li><a href="#nginx-反向代理" class="table-of-contents__link">Nginx 反向代理</a></li></ul></li><li><a href="#总结" class="table-of-contents__link">总结</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/fex/docs/advanced">前端进阶</a></li><li class="footer__item"><a class="footer__link-item" href="/fex/docs/engineering">前端工程化</a></li><li class="footer__item"><a class="footer__link-item" href="/fex/docs/algorithms">数据结构与算法</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://juejin.cn/user/571401775099528" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金</a></li><li class="footer__item"><a href="https://www.yuque.com/oxyzhg" target="_blank" rel="noopener noreferrer" class="footer__link-item">语雀</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/oxyzhg" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2021 Oxyzhg</div></div></div></footer></div>
<script src="/fex/styles.ffb24f24.js"></script>
<script src="/fex/runtime~main.8eec90ca.js"></script>
<script src="/fex/main.d2410b1b.js"></script>
<script src="/fex/1.59af2fa2.js"></script>
<script src="/fex/2.8c48b619.js"></script>
<script src="/fex/85.dafc7ca9.js"></script>
<script src="/fex/86.4d0dbeda.js"></script>
<script src="/fex/935f2afb.65d2679f.js"></script>
<script src="/fex/17896441.f11c0cb6.js"></script>
<script src="/fex/b2b771a7.03f54ade.js"></script>
</body>
</html>