<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/fex/blog/rss.xml" title="FEX Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/fex/blog/atom.xml" title="FEX Blog Atom Feed"><title data-react-helmet="true">XSS 攻击 | FEX</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="XSS 攻击 | FEX"><meta data-react-helmet="true" name="description" content="什么是 XSS"><meta data-react-helmet="true" property="og:description" content="什么是 XSS"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/fex/docs/advanced/security/xss"><link data-react-helmet="true" rel="shortcut icon" href="/fex/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/fex/docs/advanced/security/xss"><link rel="stylesheet" href="/fex/styles.861f1fa8.css">
<link rel="preload" href="/fex/styles.9a42ad01.js" as="script">
<link rel="preload" href="/fex/runtime~main.987493c9.js" as="script">
<link rel="preload" href="/fex/main.e4229a86.js" as="script">
<link rel="preload" href="/fex/1.743ce538.js" as="script">
<link rel="preload" href="/fex/2.50464f7f.js" as="script">
<link rel="preload" href="/fex/79.e9946a35.js" as="script">
<link rel="preload" href="/fex/80.13ba81f7.js" as="script">
<link rel="preload" href="/fex/935f2afb.4820d0ed.js" as="script">
<link rel="preload" href="/fex/17896441.58a135a9.js" as="script">
<link rel="preload" href="/fex/b3760e29.cf68ff7e.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/fex/"><img src="/fex/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/fex/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">FEX</strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/fex/docs/advanced">前端进阶</a><a class="navbar__item navbar__link" href="/fex/docs/engineering">工程化</a><a class="navbar__item navbar__link" href="/fex/docs/performance">性能优化</a><a href="https://github.com/oxyzhg/fex" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/fex/"><img src="/fex/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/fex/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">FEX</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/fex/docs/advanced">前端进阶</a></li><li class="menu__list-item"><a class="menu__link" href="/fex/docs/engineering">工程化</a></li><li class="menu__list-item"><a class="menu__link" href="/fex/docs/performance">性能优化</a></li><li class="menu__list-item"><a href="https://github.com/oxyzhg/fex" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/fex/docs/advanced">概览</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">JavaScript</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/javascript/inheritance">继承</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/javascript/eventloop">事件循环</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Vue.js</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/vue">概览</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/vue/data-driven">数据驱动</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/vue/componentization">组件化</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/vue/reactive">响应式原理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/vue/compile">编译</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/vue/lifecycle">生命周期</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/vue/next-tick">nextTick</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/vue/computed-vs-watch">计算属性 vs 侦听属性</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/vue/component-update">组件更新</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/vue/v-model">v-model</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/vue/mvvm">MVVM</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">React.js</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/react/lifecycle">生命周期</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">浏览器</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/browser/from-url-to-page-load">从输入URL到页面加载过程</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/browser/browser-storage">浏览器存储</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/browser/browser-cache">浏览器缓存</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/browser/browser-gc">垃圾回收</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/browser/cross-origin">跨域</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">安全</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/fex/docs/advanced/security">概览</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/fex/docs/advanced/security/xss">XSS 攻击</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/fex/docs/advanced/security/csrf">CSRF 攻击</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">网络</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/network/http">HTTP</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/fex/docs/advanced/network/websocket">WebSocket</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">XSS 攻击</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="什么是-xss"></a>什么是 XSS<a class="hash-link" href="#什么是-xss" title="Direct link to heading">#</a></h2><p>XSS（Cross-Site Scripting）跨站脚本攻击，是一种代码注入攻击。攻击者通过在目标网站上注入恶意脚本，使之在用户的浏览器上运行。利用这些恶意脚本，攻击者可获取用户的敏感信息如 Cookie、SessionID 等，进而危害数据安全。</p><p>XSS 的本质是：<strong>恶意代码未经过滤，与网站正常的代码混在一起；浏览器无法分辨哪些脚本是可信的，导致恶意脚本被执行。</strong></p><p>而由于直接在用户的终端执行，恶意代码能够直接获取用户的信息，或者利用这些信息冒充用户向网站发起攻击者定义的请求。</p><p>在部分情况下，由于输入的限制，注入的恶意脚本比较短。但可以通过引入外部的脚本，并由浏览器执行，来完成比较复杂的攻击策略。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="xss-攻击的类型"></a>XSS 攻击的类型<a class="hash-link" href="#xss-攻击的类型" title="Direct link to heading">#</a></h2><p>根据攻击的来源，XSS 攻击可分为存储型、反射型、DOM 型三种。</p><table><thead><tr><th>类型</th><th>存储区</th><th>插入点</th></tr></thead><tbody><tr><td>存储型</td><td>后端数据库</td><td>HTML</td></tr><tr><td>反射型</td><td>URL</td><td>HTML</td></tr><tr><td>DOM 型</td><td>后端数据库/前端存储/URL</td><td>前端 JavaScript</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="存储型"></a>存储型<a class="hash-link" href="#存储型" title="Direct link to heading">#</a></h3><p>存储型 XSS 的攻击步骤：</p><ol><li>攻击者将恶意代码提交到目标网站的数据库中。</li><li>用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器。</li><li>用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。</li><li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</li></ol><p>这种攻击常见于带有用户保存数据的网站功能，如论坛发帖、商品评论、用户私信等。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="反射型"></a>反射型<a class="hash-link" href="#反射型" title="Direct link to heading">#</a></h3><p>反射型 XSS 的攻击步骤：</p><ol><li>攻击者构造出特殊的 URL，其中包含恶意代码。</li><li>用户打开带有恶意代码的 URL 时，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器。</li><li>用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。</li><li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</li></ol><p>反射型 XSS 跟存储型 XSS 的区别是：存储型 XSS 的恶意代码存在数据库里，反射型 XSS 的恶意代码存在 URL 里。</p><p>反射型 XSS 漏洞常见于通过 URL 传递参数的功能，如网站搜索、跳转等。由于需要用户主动打开恶意的 URL 才能生效，攻击者往往会结合多种手段诱导用户点击。</p><p>POST 的内容也可以触发反射型 XSS，只不过其触发条件比较苛刻（需要构造表单提交页面，并引导用户点击），所以非常少见。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="dom-型"></a>DOM 型<a class="hash-link" href="#dom-型" title="Direct link to heading">#</a></h3><p>DOM 型 XSS 的攻击步骤：</p><ol><li>攻击者构造出特殊的 URL，其中包含恶意代码。</li><li>用户打开带有恶意代码的 URL。</li><li>用户浏览器接收到响应后解析执行，前端 JavaScript 取出 URL 中的恶意代码并执行。</li><li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</li></ol><p>DOM 型 XSS 跟前两种 XSS 的区别：DOM 型 XSS 攻击中，取出和执行恶意代码由浏览器端完成，属于前端 JavaScript 自身的安全漏洞，而其他两种 XSS 都属于服务端的安全漏洞。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="xss-攻击的预防"></a>XSS 攻击的预防<a class="hash-link" href="#xss-攻击的预防" title="Direct link to heading">#</a></h2><p>通过前面的介绍可以得知，XSS 攻击有两大要素：</p><ol><li>攻击者提交恶意代码</li><li>浏览器执行恶意代码</li></ol><p>针对第一个要素：我们是否能够在用户输入的过程，过滤掉用户输入的恶意代码呢？</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="输入过滤"></a>输入过滤<a class="hash-link" href="#输入过滤" title="Direct link to heading">#</a></h3><p><strong>方案一</strong>：在用户提交时，由前端过滤输入，然后提交到后端。</p><p>此方案不可行。一旦攻击者绕过前端过滤，直接构造请求，就可以提交恶意代码了。</p><p><strong>方案二</strong>：后端在写入数据库前，对输入进行过滤，然后把安全的内容，返回给前端。</p><p>此方案不可行。在提交阶段，我们并不确定内容要输出到哪里。如果作为 HTML 拼接页面时，需要使用过滤/转译后的字符串；如果作为变量值在 JavaScript 脚本中执行时，需要使用转译前的字符串，比如：用于 Vue 等模板的展示、内容长度的计算等。</p><p>所以，输入侧过滤能够在某些情况下解决特定的 XSS 问题，但会引入很大的不确定性和乱码问题。在防范 XSS 攻击时应避免此类方法。当然，对于明确的输入类型，例如数字、URL、电话号码、邮件地址等等内容，进行输入过滤还是必要的。</p><p>既然输入过滤并非完全可靠，我们就要通过<strong>防止浏览器执行恶意代码</strong>来防范 XSS。这部分分为两类：</p><ul><li>防止 HTML 中出现注入</li><li>防止 JavaScript 执行时，执行恶意代码</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="预防存储型和反射型-xss-攻击"></a>预防存储型和反射型 XSS 攻击<a class="hash-link" href="#预防存储型和反射型-xss-攻击" title="Direct link to heading">#</a></h3><p>存储型和反射型 XSS 都是在服务端取出恶意代码后，插入到响应 HTML 里的，攻击者刻意编写的“数据”被内嵌到“代码”中，被浏览器所执行。</p><p>预防这两种漏洞，有两种常见做法：</p><ul><li>纯前端渲染，把代码和数据分隔开</li><li>对 HTML 做充分转义</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="纯前端渲染"></a>纯前端渲染<a class="hash-link" href="#纯前端渲染" title="Direct link to heading">#</a></h4><p>纯前端渲染的过程：</p><ol><li>浏览器先加载一个静态 HTML，此 HTML 中不包含任何跟业务相关的数据。</li><li>然后浏览器执行 HTML 中的 JavaScript。</li><li>JavaScript 通过 Ajax 加载业务数据，调用 DOM API 更新到页面上。</li></ol><p>在纯前端渲染中，我们会明确的告诉浏览器：下面要设置的内容是文本（<code>.innerText</code>），还是属性（<code>.setAttribute</code>），还是样式（<code>.style</code>）等等。浏览器不会被轻易的被欺骗，执行预期外的代码了。</p><p>但纯前端渲染还需注意避免 DOM 型 XSS 漏洞（例如 <code>onload</code> 事件和 <code>href</code> 中的 <code>javascript:xxx</code> 等，请参考下文”预防 DOM 型 XSS 攻击“部分）。</p><p>在很多内部、管理系统中，采用纯前端渲染是非常合适的。但对于性能要求高，或有 SEO 需求的页面，我们仍然要面对拼接 HTML 的问题。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="转译-html"></a>转译 HTML<a class="hash-link" href="#转译-html" title="Direct link to heading">#</a></h4><p>如果拼接 HTML 是必要的，就需要采用合适的转义库，对 HTML 模板各处插入点进行充分的转义。</p><p>常用的模板引擎，如 doT.js、ejs、FreeMarker 等，对于 HTML 转义通常只有一个规则，就是把 <code>&amp; &lt; &gt; &quot; &#x27; /</code> 这几个字符转义掉，确实能起到一定的 XSS 防护作用，但并不完善：</p><table><thead><tr><th>XSS 安全漏洞</th><th>简单转义是否有防护作用</th></tr></thead><tbody><tr><td>HTML 标签文字内容</td><td>有</td></tr><tr><td>HTML 属性值</td><td>有</td></tr><tr><td>CSS 内联样式</td><td>无</td></tr><tr><td>内联 JavaScript</td><td>无</td></tr><tr><td>内联 JSON</td><td>无</td></tr><tr><td>跳转链接</td><td>无</td></tr></tbody></table><p>所以要完善 XSS 防护措施，我们要使用更完善更细致的转义策略。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="预防-dom-型-xss-攻击"></a>预防 DOM 型 XSS 攻击<a class="hash-link" href="#预防-dom-型-xss-攻击" title="Direct link to heading">#</a></h3><p>DOM 型 XSS 攻击，实际上就是网站前端 JavaScript 代码本身不够严谨，把不可信的数据当作代码执行了。</p><p>在使用 <code>.innerHTML</code>、<code>.outerHTML</code>、<code>document.write()</code> 时要特别小心，不要把不可信的数据作为 HTML 插到页面上，而应尽量使用 <code>.textContent</code>、<code>.setAttribute()</code> 等。</p><p>如果用 Vue/React 技术栈，并且不使用 <code>v-html</code>/<code>dangerouslySetInnerHTML</code> 功能，就在前端 render 阶段避免 <code>innerHTML</code>、<code>outerHTML</code> 的 XSS 隐患。</p><p>DOM 中的内联事件监听器，如 <code>location</code>、<code>onclick</code>、<code>onerror</code>、<code>onload</code>、<code>onmouseover</code> 等，<code>&lt;a&gt;</code> 标签的 <code>href</code> 属性，JavaScript 的 <code>eval()</code>、<code>setTimeout()</code>、<code>setInterval()</code> 等，都能把字符串作为代码运行。如果不可信的数据拼接到字符串中传递给这些 API，很容易产生安全隐患，请务必避免。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="其他-xss-防范措施"></a>其他 XSS 防范措施<a class="hash-link" href="#其他-xss-防范措施" title="Direct link to heading">#</a></h3><p>虽然在渲染页面和执行 JavaScript 时，通过谨慎的转义可以防止 XSS 的发生，但完全依靠开发的谨慎仍然是不够的。以下介绍一些通用的方案，可以降低 XSS 带来的风险和后果。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="content-security-policy"></a>Content Security Policy<a class="hash-link" href="#content-security-policy" title="Direct link to heading">#</a></h4><p>严格的 CSP 在 XSS 的防范中可以起到以下的作用：</p><ul><li>禁止加载外域代码，防止复杂的攻击逻辑。</li><li>禁止外域提交，网站被攻击后，用户的数据不会泄露到外域。</li><li>禁止内联脚本执行（规则较严格，目前发现 GitHub 使用）。</li><li>禁止未授权的脚本执行（新特性，Google Map 移动版在使用）。</li><li>合理使用上报可以及时发现 XSS，利于尽快修复问题。</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="输入内容长度控制"></a>输入内容长度控制<a class="hash-link" href="#输入内容长度控制" title="Direct link to heading">#</a></h4><p>对于不受信任的输入，都应该限定一个合理的长度。虽然无法完全防止 XSS 发生，但可以增加 XSS 攻击的难度。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="其他安全措施"></a>其他安全措施<a class="hash-link" href="#其他安全措施" title="Direct link to heading">#</a></h4><ul><li>验证码：防止脚本冒充用户提交危险操作。</li><li>HTTP-only Cookie: 禁止 JavaScript 读取某些敏感 Cookie，攻击者完成 XSS 注入后也无法窃取此 Cookie。</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="xss-的检测"></a>XSS 的检测<a class="hash-link" href="#xss-的检测" title="Direct link to heading">#</a></h2><p>在 <a href="https://github.com/0xsobky/HackVault/wiki/Unleashing-an-Ultimate-XSS-Polyglot" target="_blank" rel="noopener noreferrer">Unleashing an Ultimate XSS Polyglot</a> 一文中，提到有以下字符串能够检测到存在于 HTML 属性、HTML 文字内容、HTML 注释、跳转链接、内联 JavaScript 字符串、内联 CSS 样式表等多种上下文中的 XSS 漏洞，也能检测 <code>eval()</code>、<code>setTimeout()</code>、<code>setInterval()</code>、Function()、innerHTML、document.write() 等 DOM 型 XSS 漏洞，并且能绕过一些 XSS 过滤器。</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-js codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">jaVasCript</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">/*-/*`/*\`/*&#x27;/*&quot;/**/</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">/* */</span><span class="token plain"> oNcliCk </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">alert</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">//%0D%0A%0d%0a//&lt;/stYle/&lt;/titLe/&lt;/teXtarEa/&lt;/scRipt/--!&gt;\x3csVg/&lt;sVg/oNloAd=alert()//&gt;\x3e</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>除了手动检测之外，还可以使用自动扫描工具寻找 XSS 漏洞，例如 <a href="https://github.com/Arachni/arachni" target="_blank" rel="noopener noreferrer">Arachni</a>、<a href="https://github.com/mozilla/http-observatory/" target="_blank" rel="noopener noreferrer">Mozilla HTTP Observatory</a>、<a href="https://github.com/andresriancho/w3af" target="_blank" rel="noopener noreferrer">w3af</a> 等。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="总结"></a>总结<a class="hash-link" href="#总结" title="Direct link to heading">#</a></h2><p>XSS 攻击的特点是注入恶意代码，且得到执行。</p><p>那么我们要预防 XSS 攻击，关键是要<strong>防止恶意代码被执行</strong>。在输出 HTML 时对用户输入的代码进行转译，不同的上下文，如 HTML 属性、HTML 文字内容、HTML 注释、跳转链接、内联 JavaScript 字符串、内联 CSS 样式表等，所需要的转义规则不一致。另外，还要防止多余和错误的转义，避免正常的用户输入出现乱码。</p><p>虽然很难通过技术手段完全避免 XSS，但我们可以总结以下原则减少漏洞的产生：</p><ul><li><strong>利用模板引擎</strong>：开启模板引擎自带的 HTML 转义功能。</li><li><strong>避免内联事件</strong>：尽量不要使用 <code>onLoad=&quot;onload(&#x27;{{data}}&#x27;)&quot;</code>、<code>onClick=&quot;go(&#x27;{{action}}&#x27;)</code>&quot; 这种拼接内联事件的写法。在 JavaScript 中通过 <code>addEventlistener()</code> 事件绑定会更安全。</li><li><strong>避免拼接 HTML</strong>：前端采用拼接 HTML 的方法比较危险，如果框架允许，使用 <code>createElement</code>、<code>setAttribute</code> 之类的方法实现。或者采用比较成熟的渲染框架，如 Vue/React 等。</li><li><strong>时刻保持警惕</strong>：在插入位置为 DOM 属性、链接等位置时，要打起精神，严加防范。</li><li><strong>增加攻击难度，降低攻击后果</strong>：通过 CSP、输入长度配置、接口安全措施等方法，增加攻击的难度，降低攻击的后果。</li><li><strong>主动检测和发现</strong>：可使用 XSS 攻击字符串和自动扫描工具寻找潜在的 XSS 漏洞。</li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/oxyzhg/fex/edit/main/docs/advanced/security/xss.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/fex/docs/advanced/security"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 概览</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/fex/docs/advanced/security/csrf"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">CSRF 攻击 »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#什么是-xss" class="table-of-contents__link">什么是 XSS</a></li><li><a href="#xss-攻击的类型" class="table-of-contents__link">XSS 攻击的类型</a><ul><li><a href="#存储型" class="table-of-contents__link">存储型</a></li><li><a href="#反射型" class="table-of-contents__link">反射型</a></li><li><a href="#dom-型" class="table-of-contents__link">DOM 型</a></li></ul></li><li><a href="#xss-攻击的预防" class="table-of-contents__link">XSS 攻击的预防</a><ul><li><a href="#输入过滤" class="table-of-contents__link">输入过滤</a></li><li><a href="#预防存储型和反射型-xss-攻击" class="table-of-contents__link">预防存储型和反射型 XSS 攻击</a></li><li><a href="#预防-dom-型-xss-攻击" class="table-of-contents__link">预防 DOM 型 XSS 攻击</a></li><li><a href="#其他-xss-防范措施" class="table-of-contents__link">其他 XSS 防范措施</a></li></ul></li><li><a href="#xss-的检测" class="table-of-contents__link">XSS 的检测</a></li><li><a href="#总结" class="table-of-contents__link">总结</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/fex/docs/advanced">前端进阶</a></li><li class="footer__item"><a class="footer__link-item" href="/fex/docs/engineering">前端工程化</a></li><li class="footer__item"><a class="footer__link-item" href="/fex/docs/algorithms">数据结构与算法</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://juejin.cn/user/571401775099528" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金</a></li><li class="footer__item"><a href="https://www.yuque.com/oxyzhg" target="_blank" rel="noopener noreferrer" class="footer__link-item">语雀</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/oxyzhg" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2021 Oxyzhg</div></div></div></footer></div>
<script src="/fex/styles.9a42ad01.js"></script>
<script src="/fex/runtime~main.987493c9.js"></script>
<script src="/fex/main.e4229a86.js"></script>
<script src="/fex/1.743ce538.js"></script>
<script src="/fex/2.50464f7f.js"></script>
<script src="/fex/79.e9946a35.js"></script>
<script src="/fex/80.13ba81f7.js"></script>
<script src="/fex/935f2afb.4820d0ed.js"></script>
<script src="/fex/17896441.58a135a9.js"></script>
<script src="/fex/b3760e29.cf68ff7e.js"></script>
</body>
</html>