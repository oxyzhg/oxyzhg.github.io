<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/fex/blog/rss.xml" title="FEX Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/fex/blog/atom.xml" title="FEX Blog Atom Feed"><title data-react-helmet="true">CSRF 攻击 | FEX</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="CSRF 攻击 | FEX"><meta data-react-helmet="true" name="description" content="什么是 CSRF"><meta data-react-helmet="true" property="og:description" content="什么是 CSRF"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/fex/docs/advanced/security/csrf"><link data-react-helmet="true" rel="shortcut icon" href="/fex/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/fex/docs/advanced/security/csrf"><link rel="stylesheet" href="/fex/styles.7ff90892.css">
<link rel="preload" href="/fex/styles.1ed836ce.js" as="script">
<link rel="preload" href="/fex/runtime~main.f77e6306.js" as="script">
<link rel="preload" href="/fex/main.2416c56f.js" as="script">
<link rel="preload" href="/fex/1.9e57cca6.js" as="script">
<link rel="preload" href="/fex/2.779dd229.js" as="script">
<link rel="preload" href="/fex/43.d76d4b24.js" as="script">
<link rel="preload" href="/fex/44.8e1620d1.js" as="script">
<link rel="preload" href="/fex/935f2afb.0a1f7ec8.js" as="script">
<link rel="preload" href="/fex/17896441.ad40f7b2.js" as="script">
<link rel="preload" href="/fex/df68dfea.9f1a4ca7.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/fex/"><img src="/fex/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/fex/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">FEX</strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/fex/docs/advanced">前端进阶</a><a class="navbar__item navbar__link" href="/fex/docs/engineering">前端工程化</a><a href="https://github.com/oxyzhg/fex" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/fex/"><img src="/fex/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/fex/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">FEX</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/fex/docs/advanced">前端进阶</a></li><li class="menu__list-item"><a class="menu__link" href="/fex/docs/engineering">前端工程化</a></li><li class="menu__list-item"><a href="https://github.com/oxyzhg/fex" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/fex/docs/advanced">Style Guide</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Vue.js</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/fex/docs/advanced/vue">概览</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/fex/docs/advanced/vue/data-driven">数据驱动</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/fex/docs/advanced/vue/componentization">组件化</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/fex/docs/advanced/vue/reactive">响应式原理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/fex/docs/advanced/vue/compile">编译</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">安全</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/fex/docs/advanced/security/xss">XSS 攻击</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/fex/docs/advanced/security/csrf">CSRF 攻击</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">CSRF 攻击</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="什么是-csrf"></a>什么是 CSRF<a class="hash-link" href="#什么是-csrf" title="Direct link to heading">#</a></h2><p>CSRF（Cross-site request forgery）跨站请求伪造：攻击者诱导受害者进入第三方网站，在第三方网站中，向被攻击网站发送跨站请求。利用受害者在被攻击网站已经获取的注册凭证，绕过后台的用户验证，达到冒充用户对被攻击的网站执行某项操作的目的。</p><p>一个典型的 CSRF 攻击有着如下的流程：</p><ul><li>受害者登录 a.com，并保留了登录凭证（Cookie）；</li><li>攻击者引诱受害者访问了 b.com；</li><li>b.com 向 a.com 发送了一个请求：a.com/act=xx；浏览器会默认携带 a.com 的 Cookie；</li><li>a.com 接收到请求后，对请求进行验证，并确认是受害者的凭证，误以为是受害者自己发送的请求；</li><li>a.com 以受害者的名义执行了 act=xx；</li><li>攻击完成，攻击者在受害者不知情的情况下，冒充受害者，让 a.com 执行了自己定义的操作；</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="常见的攻击类型"></a>常见的攻击类型<a class="hash-link" href="#常见的攻击类型" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="get-类型"></a>GET 类型<a class="hash-link" href="#get-类型" title="Direct link to heading">#</a></h3><p>GET 类型的 CSRF 利用非常简单，只需要一个 HTTP 请求，一般会这样利用：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-markdown codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">![](https://awps-assets.meituan.net/mit-x/blog-images-bundle-2018b/ff0cdbee.example/withdraw?amount=10000&amp;for=hacker)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>在受害者访问含有这个 img 的页面后，浏览器会自动向 <code>http://bank.example/withdraw?account=xiaoming&amp;amount=10000&amp;for=hacker</code> 发出一次 HTTP 请求。bank.example 就会收到包含受害者登录信息的一次跨域请求。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="post-类型"></a>POST 类型<a class="hash-link" href="#post-类型" title="Direct link to heading">#</a></h3><p>这种类型的 CSRF 利用起来通常使用的是一个自动提交的表单，如：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-html codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">form</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">action</span><span class="token tag attr-value punctuation" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">http://bank.example/withdraw</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">method</span><span class="token tag attr-value punctuation" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">POST</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">input</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">hidden</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">account</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">value</span><span class="token tag attr-value punctuation" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">xiaoming</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">input</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">hidden</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">amount</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">value</span><span class="token tag attr-value punctuation" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">10000</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">input</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">hidden</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">for</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">value</span><span class="token tag attr-value punctuation" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">hacker</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">form</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token script language-javascript dom variable" style="color:#36acaa">document</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">forms</span><span class="token script language-javascript punctuation" style="color:#393A34">[</span><span class="token script language-javascript number" style="color:#36acaa">0</span><span class="token script language-javascript punctuation" style="color:#393A34">]</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">submit</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#393A34"><span class="token script language-javascript"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>访问该页面后，表单会自动提交，相当于模拟用户完成了一次 POST 操作。</p><p>POST 类型的攻击通常比 GET 要求更加严格一点，但仍并不复杂。任何个人网站、博客，被黑客上传页面的网站都有可能是发起攻击的来源，后端接口不能将安全寄托在仅允许 POST 上面。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="链接类型"></a>链接类型<a class="hash-link" href="#链接类型" title="Direct link to heading">#</a></h3><p>链接类型的 CSRF 并不常见，比起其他两种用户打开页面就中招的情况，这种需要用户点击链接才会触发。这种类型通常是在论坛中发布的图片中嵌入恶意链接，或者以广告的形式诱导用户中招，攻击者通常会以比较夸张的词语诱骗用户点击，例如：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-html codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">a</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">href</span><span class="token tag attr-value punctuation" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">http://test.com/csrf/withdraw.php?amount=1000&amp;for=hacker</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">taget</span><span class="token tag attr-value punctuation" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">_blank</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">重磅消息！！</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">a</span><span class="token tag punctuation" style="color:#393A34">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>由于之前用户登录了信任的网站 A，并且保存登录状态，只要用户主动访问上面的这个 PHP 页面，则表示攻击成功。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="csrf-的特点"></a>CSRF 的特点<a class="hash-link" href="#csrf-的特点" title="Direct link to heading">#</a></h2><ul><li>攻击一般发起在第三方网站，而不是被攻击的网站。被攻击的网站无法防止攻击发生。</li><li>攻击利用受害者在被攻击网站的登录凭证，冒充受害者提交操作；而不是直接窃取数据。</li><li>整个过程攻击者并不能获取到受害者的登录凭证，仅仅是“冒用”。</li><li>跨站请求可以用各种方式：图片 URL、超链接、CORS、Form 提交等。部分请求方式可以直接嵌入在第三方论坛、文章中，难以进行追踪。</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="防护策略"></a>防护策略<a class="hash-link" href="#防护策略" title="Direct link to heading">#</a></h2><p>CSRF 通常从第三方网站发起，被攻击的网站无法防止攻击发生，只能通过增强自己网站针对 CSRF 的防护能力来提升安全性。</p><p>上文中讲了 CSRF 的两个特点：</p><ul><li>CSRF 通常发生在第三方域名。</li><li>CSRF 攻击者不能获取到 Cookie 等信息，只是使用。</li></ul><p>针对这两点，我们可以专门制定防护策略，如下：</p><ul><li>阻止不明外域的访问<ul><li>同源检测</li><li>Samesite Cookie</li></ul></li><li>提交时要求附加本域才能获取的信息<ul><li>CSRF Token</li><li>双重 Cookie 验证</li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="同源检测"></a>同源检测<a class="hash-link" href="#同源检测" title="Direct link to heading">#</a></h3><p>既然 CSRF 大多来自第三方网站，那么我们就直接禁止外域（或者不受信任的域名）对我们发起请求。</p><p>在 HTTP 协议中，每一个异步请求都会携带两个 Request Header，用于标记来源域名：<code>Origin</code> 和 <code>Referer</code>。它们在浏览器发起请求时，大多数情况会自动带上，并且不能由前端自定义内容。</p><p>服务器可以通过解析这两个 Header 中的域名，确定请求的来源域。如果 Origin 存在，那么直接使用 Origin 中的字段确认来源域名就可以。但是 Origin 在某些情况下并不存在：IE11 同源策略、302 重定向，这时可以解析 Referer 进行判断。</p><p>2014 年，W3C 的 Web 应用安全工作组发布了 Referrer Policy 草案，对浏览器该如何发送 Referer 做了详细的规定。截止现在新版浏览器大部分已经支持了这份草案，我们终于可以灵活地控制自己网站的 Referer 策略了。</p><table><thead><tr><th>Policy Name</th><th>Value</th></tr></thead><tbody><tr><td>No Referrer</td><td>no-referrer</td></tr><tr><td>No Referrer When Downgrade</td><td>no-referrer-when-downgrade</td></tr><tr><td>Origin Only</td><td>(same or strict) origin</td></tr><tr><td>Origin When Cross Origin</td><td>(strict) origin-when-cross-origin</td></tr><tr><td>Unsafe URL</td><td>unsafe-url</td></tr></tbody></table><p>根据上面的表格因此需要把 Referrer Policy 的策略设置成 <code>same-origin</code>，对于同源的链接和引用，会发送 Referer，referer 值为 Host 不带 Path；跨域访问则不携带 Referer。例如：aaa.com 引用 bbb.com 的资源，不会发送 Referer。</p><p>设置 Referrer Policy 的方法有三种：</p><ul><li>在 CSP 设置</li><li>页面头部增加 meta 标签</li><li>a 标签增加 referrerpolicy 属性</li></ul><p>另外在以下情况下 Referer 没有或者不可信：</p><ul><li>IE6/7 下使用 <code>window.location.href=url</code> 进行界面的跳转，会丢失 Referer。</li><li>IE6/7 下使用 <code>window.open</code>，也会缺失 Referer。</li><li>HTTPS 页面跳转到 HTTP 页面，所有浏览器 Referer 都丢失。</li></ul><p>如果 Origin 和 Referer 都不存在，建议直接进行阻止。</p><p>综上所述：同源验证是一个相对简单的防范方法，能够防范绝大多数的 CSRF 攻击。但这并不是万无一失的，对于安全性要求较高，或者有较多用户输入内容的网站，我们就要对关键的接口做额外的防护措施。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="csrf-token"></a>CSRF Token<a class="hash-link" href="#csrf-token" title="Direct link to heading">#</a></h3><p>前面讲到 CSRF 的另一个特征是，攻击者无法直接窃取到用户的信息（Cookie，Header，网站内容等），仅仅是冒用 Cookie 中的信息。</p><p>而 CSRF 攻击之所以能够成功，是因为服务器误把攻击者发送的请求当成了用户自己的请求。那么我们可以要求所有的用户请求都携带一个 CSRF 攻击者无法获取到的 Token。服务器通过校验请求是否携带正确的 Token，来把正常的请求和攻击的请求区分开，也可以防范 CSRF 的攻击。</p><p>CSRF Token 的防护策略分为三个步骤：</p><ol><li>将 CSRF Token 输出到页面中</li><li>页面提交的请求携带这个 Token</li><li>服务器验证 Token 是否正确</li></ol><p>Token 是一个比较有效的 CSRF 防护方法，只要页面没有 XSS 漏洞泄露 Token，那么接口的 CSRF 攻击就无法成功。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="双重-cookie-验证"></a>双重 Cookie 验证<a class="hash-link" href="#双重-cookie-验证" title="Direct link to heading">#</a></h3><hr><p>参考资料：</p><ul><li><a href="https://tech.meituan.com/2018/09/27/fe-security.html" target="_blank" rel="noopener noreferrer">前端安全系列（一）：如何防止 XSS 攻击？</a></li><li><a href="https://tech.meituan.com/2018/10/11/fe-security-csrf.html" target="_blank" rel="noopener noreferrer">前端安全系列（二）：如何防止 CSRF 攻击？</a></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/oxyzhg/fex/edit/main/docs/advanced/security/csrf.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/fex/docs/advanced/security/xss"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« XSS 攻击</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#什么是-csrf" class="table-of-contents__link">什么是 CSRF</a></li><li><a href="#常见的攻击类型" class="table-of-contents__link">常见的攻击类型</a><ul><li><a href="#get-类型" class="table-of-contents__link">GET 类型</a></li><li><a href="#post-类型" class="table-of-contents__link">POST 类型</a></li><li><a href="#链接类型" class="table-of-contents__link">链接类型</a></li></ul></li><li><a href="#csrf-的特点" class="table-of-contents__link">CSRF 的特点</a></li><li><a href="#防护策略" class="table-of-contents__link">防护策略</a><ul><li><a href="#同源检测" class="table-of-contents__link">同源检测</a></li><li><a href="#csrf-token" class="table-of-contents__link">CSRF Token</a></li><li><a href="#双重-cookie-验证" class="table-of-contents__link">双重 Cookie 验证</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/fex/docs/advanced">前端进阶</a></li><li class="footer__item"><a class="footer__link-item" href="/fex/docs/engineering">前端工程化</a></li><li class="footer__item"><a class="footer__link-item" href="/fex/docs/algorithms">数据结构与算法</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://juejin.cn/user/571401775099528" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金</a></li><li class="footer__item"><a href="https://www.yuque.com/oxyzhg" target="_blank" rel="noopener noreferrer" class="footer__link-item">语雀</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/oxyzhg" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2021 Oxyzhg</div></div></div></footer></div>
<script src="/fex/styles.1ed836ce.js"></script>
<script src="/fex/runtime~main.f77e6306.js"></script>
<script src="/fex/main.2416c56f.js"></script>
<script src="/fex/1.9e57cca6.js"></script>
<script src="/fex/2.779dd229.js"></script>
<script src="/fex/43.d76d4b24.js"></script>
<script src="/fex/44.8e1620d1.js"></script>
<script src="/fex/935f2afb.0a1f7ec8.js"></script>
<script src="/fex/17896441.ad40f7b2.js"></script>
<script src="/fex/df68dfea.9f1a4ca7.js"></script>
</body>
</html>