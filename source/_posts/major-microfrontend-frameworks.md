---
title: 几种主流的微前端架构设计
author: Kq
date: 2019-12-21 17:26:56
categories:
  - 架构
tags:
  - microfrontend
  - 微前端
---

> 微前端话题已不再陌生，几个知名前端团队也都分享了他们的微前端解决方案，结合这些解决方案我们来聊聊几种主流的微前端架构设计。

## MPA + 路由分发

在多个 SPA 应用间切换，让用户感觉像是同一个应用。

优点：

- 框架无关
- 独立开发、部署、运行
- 应用百分百隔离

缺点：

- 应用彻底割裂，导致复用困难
- 每个独立 SPA 加载时间较长，容易出现白屏，影响用户体验
- 拓展性查，不利于实现同屏多应用

## 类 Single-SPA 方案

主应用仅作为加载容器，管理子应用的声明周期。主应用捕获全局的路由事件，判断当前路由规则命中哪个子应用，然后加载应用，否则卸载。

优点：

- 框架无关
- 独立开发、部署、运行
- 项目自由切割，可自由组合
- 方便自由拓展功能

缺点：

- 子应用需要实现 `mount`, `unmount` 等钩子，侵入式的代码体验并不好
- 全局污染和资源竞争

## 基座式 SPA 主从应用设计

这里的“基座”就是主应用，它会包含应用依赖的绝大多数环境，包括基础框架、基础组件和第三方依赖，而子应用只需要包含自己的业务代码（以及主应用不包含的第三方库）。同样的，主应用捕获全局路由事件，判断当前应该加载哪个应用。这里路由有点不同，类 single-spa 方案中，加载子应用后会接管路由，而在基座式方案中，子应用一般会把路由注册到主应用，也就是说只有一套路由体系，它们之间是主从关系，子应用像是 SPA 其中一隅，整个项目更像是一个 SPA 应用。

优点：

- 打包后的子应用只包含业务代码，体积小、加载快、用户体验好
  缺点：
- 基座模式决定了主从应用的强相关性，相互之间会造成 break change

这个方案需要对自定义构建的依赖颇多，基本上需要自己定义一套方案，来解决公共资源的问题（当然这是难点不是缺点）。我见过有类似方案做的不够完善的，未能实现独立构建，而是必须依赖于主应用构建，也就是所谓的 构建时组合。同时，这种方式对规范的依赖最强，我们必须遵照一定的规范来开发项目，从 dev 到 build，都需要建设自己的开发体系来实现上述效果。

## 传统 SPA + 组件化(WebComponents) + 私有 npm 源

简而言之，就是把通用的一些业务功能发布成组件，通过私有 npm 的方式去维护和管理。其中，跟框架无关又比较有代表性的方案就属 Web Components 了。当然，这种模式更像是业务组件，或者说业务模块，而不是应用。

优点：

- 对现有项目渐进式增强，逐步改进

缺点：

- 随着业务中组件数量的爆发式增加，组件粒度通信、组件的维护成本都急剧增加
- 不能做到真正的独立开发、测试、部署

## 几种解决方案总结

1. MPA + 路由分发
2. 类 Single-SPA 方案
3. 基座式 SPA，主从应用设计
4. 传统 SPA + 组件化(WebComponents) + 私有 npm 源

总体分析下来，类 Single-SPA 是相对较好的。
